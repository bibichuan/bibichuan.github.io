<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hexo自定义主题（三）</title>
    <!-- 页面描述 -->
<meta name="description" content=""/>
<!-- 页面关键词 -->
<meta name="keywords" content=""/>
<!-- 网页作者 -->
<meta name="author" content="bibichuan, ibibichuan@gmail.com"/>
<!-- 搜索引擎抓取 -->
<meta name="robots" content="index,follow"/>

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>

<!--禁止百度转码-->
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<!--启用WebApp全屏模式-->
<meta name="apple-mobile-web-app-capable" content="yes" />
<!--禁止数字自动识别为电话号码-->
<meta name="format-detection" content="telephone=no" />
<!--忽略识别邮箱-->
<meta name="format-detection" content="email=no" />
<!--360强制谷歌内核-->
<meta name="renderer" content="webkit"> 

<link rel="icon" href="/images/favicon.ico">

<link rel="stylesheet" href="//at.alicdn.com/t/font_1022896_nclaqhxyt.css">

<link href="/css/main.css" rel="stylesheet" type="text/css" />

<!-- 谷歌广告 -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8382618401389723"></script>


<script type="text/javascript" id="hexo.configurations">
  var BTheme = window.BTheme ||{};
  var CONFIG = {
    root: '/'
  };
</script>

<!--百度统计-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ee4ff785c4c68fa9a0ea17241e0574ea";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!--谷歌统计-->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G4HPTST8XX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-G4HPTST8XX');
</script>

    
    
        
    
        
            
            
            <link href="/lib/layui/css/layui.css" rel="stylesheet" type="text/css" />
        
    

    
        
    

    
        
    


    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.css" />
<link rel="stylesheet" type="text/css" href="/lib/share/style/css/ishare.css">

<meta name="generator" content="Hexo 5.4.2"></head>
<body class="main">

    <header id="header" class="header layui-fluid">
        <div class="header-inner layui-row"><div class="header-wrap">
    <div class="logo_wrap">
        <a href="/"><img src="/images/logo.png"></a>
    </div>
    <div class='search-warp'>
  <div class="search">
    <input class="search-ipt" placeholder="请输入搜索内容"/>
    <div class="search-btn clear"><i class="iconfont icon-guanbi"></i></div>
    <div class="search-btn find"><i class="iconfont icon-sousuo"></i></div>
  </div>
  <div class="result">
    <ul class="result-content"></ul>
  </div>
</div>
    <div class="icon-menu"><i class="iconfont icon-m_menu"></i></div>
    <nav class="site-nav">
        <ul class="menu layui-nav">
            
            
            <li class="menu-item layui-nav-item">
                <a href="/" rel="section">
                    <i class="iconfont icon-home"></i>首页<i class="iconfont icon-header-mobile icon-right"></i>
                </a>
            </li>
            
            

            
            

            
            
                
                
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/%E6%9D%82%E6%96%87/">
                                    杂文
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/Python/">
                                    Python
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/Gis/">
                                    Gis
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/Asp/">
                                    Asp
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/%E8%BD%AF%E4%BB%B6/">
                                    软件
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                
                <li class="more menu-item layui-nav-item">
                    
                    <a href="javascript:;" class="menu-more">
                        更多分类
                        <i class="iconfont icon-header-mobile icon-sidemenu"></i>
                    </a>
                    
                    <dl class="layui-nav-child">
                        
                            
                            
                        
                            
                            
                        
                            
                            
                        
                            
                            
                        
                            
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/Java/">
                                            Java
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E5%89%8D%E7%AB%AF/">
                                            前端
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/Javascript/">
                                            Javascript
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                            数据库
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
                                            操作系统
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/Nodejs/">
                                            Nodejs
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">
                                            大数据
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1/">
                                            后台服务
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E9%9A%8F%E7%AC%94/">
                                            随笔
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">
                                            机器学习
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E5%85%B6%E4%BB%96/">
                                            其他
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                    </dl>
                </li>
            
        </ul>
    </nav>
</div></div>
    </header>
    
    <main class="main-content layui-fluid" id="main-content">
      <div class="main-inner">
        
  <div class="layui-row layui-col-space15">
    <div class="layui-col-xs12 layui-col-sm10 layui-col-sm-offset1 layui-col-md6 layui-col-md-offset2 layui-col-lg6 layui-col-lg-offset2">
        <div class="container post_wrap">
          <div class="post">
            <div class="article">
              <h1 class="title">Hexo自定义主题（三）</h1>
              <div class="author">
                <span class="tag">标签：
                  

                  
                    
                    
                      
                      
                      <a href="/tags/Hexo/">Hexo</a>
                    
                  
                </span>
                <span class="tag">分类：
                  

                  
                    
                    
                      
                      
                      <a href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
                    
                  
                </span>
                <span class='tag'>
                  创建时间：2019-06-11 03:20:38
                </span>
                <span class='tag'>
                  更新时间：2025-04-28 14:37:40
                </span>
              </div>
              <div class="content">
                <html><head></head><body><p>这篇文章是自定义主题的第三部，对于我自定义主题来说，其实没有网上其他人写的那么有条理，有步骤，我总是想到什么写什么，在我博客中其他的文章中也可以看出来，今天突发奇想，想为博客添加一些功能，就顺手写下来了。自定义主题这么久以来，对主题和整个hexo的运行来说，也多多少少的有了写经验，其实刚开始写的时候，感觉特别的复杂，查看next主题的源码，也是云里雾里的，时间长了，也就是那么回事。首先就是要学会swig语法，然后就是组织好主题的目录结构，这个模板引入了那个模板，这个模板添加了某个js文件，理清思路就好写多了。</p>
<h2 id="1-添加分享"><a href="#1-添加分享" class="headerlink" title="1.添加分享"></a>1.添加分享</h2><p>分享插件其实有很多，自己写也是一个套路，主要就是构造一个分享的url，然后执行跳转就可以了。比来比去，像百度分享，bShare分享，虽然功能强大，但是也太丑了点，我选择了iShare这个分享插件，引入也挺简单的。</p>
<h3 id="引入iconfont、css和js"><a href="#引入iconfont、css和js" class="headerlink" title="引入iconfont、css和js"></a>引入iconfont、css和js</h3><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"{{ url_for(theme.lib) }}/share/style/fonts/iconfont.css"</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"{{ url_for(theme.lib) }}/share/style/css/ishare.css"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"{{ url_for(theme.lib) }}/share/iShare.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// 添加div</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"iShare iShare-content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// 创建实例</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> iSharel=(<span class="keyword">new</span> <span class="title function_">iShare</span>({<span class="attr">container</span>:<span class="string">'.iShare-content'</span>,<span class="attr">config</span>:{</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">title</span>: <span class="string">'这里有精彩的内容，你确定不过来看看吗？{{page.title}}:{{page.permalink}}(复制此地址在浏览器中打开)。bibichaun出品。'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">description</span>: <span class="string">'{{page.title}}'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">url</span>: <span class="string">'{{page.permalink}}'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">isAbroad</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">isTitle</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">initialized</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="title class_">WXoptions</span>:{</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="attr">evenType</span>: <span class="string">'click'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="attr">isTitleVisibility</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="attr">title</span>: <span class="string">'{{page.title}}'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="attr">isTipVisibility</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="attr">tip</span>: <span class="string">'{{page.title}}'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="attr">qrcodeW</span>: <span class="string">'120'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="attr">qrcodeH</span>: <span class="string">'120'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="attr">qrcodeFgc</span>: <span class="string">'#4a148c'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">bgcolor</span>: <span class="string">'#2BAD13'</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		}</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	}}));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="修改iShare"><a href="#修改iShare" class="headerlink" title="修改iShare"></a>修改iShare</h3><p>iShare自三年前完成这个插件之后，就一直没有更新了，在使用的过程中，我发现了一些问题，比如:</p>
<p>(1)在添加微信二维码时，脚本自动加载了当前页面下的qrcode.min.js，而不是和iShare.js同目录下的js文件，可能造成引用不到qrcode的情况，所以，我将Util.loadjs这里改掉了,在加载之前先判断iShare所在路径，然后执行加载js。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//原先</span></span><br><span class="line"><span class="title class_">Util</span>.<span class="title function_">loadjs</span>(<span class="string">'qrcode.min.js'</span>, <span class="variable language_">this</span>.<span class="property">wx</span>.<span class="title function_">startQR</span>());</span><br><span class="line"><span class="comment">// 现在加载qrcode库</span></span><br><span class="line"><span class="keyword">var</span> js = <span class="variable language_">document</span>.<span class="property">scripts</span>;</span><br><span class="line"><span class="keyword">var</span> path = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">var</span> c=js.<span class="property">length</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;c;i++){</span><br><span class="line">  <span class="keyword">var</span> it=js[i];</span><br><span class="line">  <span class="keyword">var</span> src=it.<span class="property">src</span>;</span><br><span class="line">  <span class="keyword">if</span>(src.<span class="title function_">indexOf</span>(<span class="string">"iShare"</span>)&gt;=<span class="number">0</span>){</span><br><span class="line">    path=src.<span class="title function_">substring</span>(<span class="number">0</span>,src.<span class="title function_">lastIndexOf</span>(<span class="string">'/'</span>)+<span class="number">1</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="title class_">Util</span>.<span class="title function_">loadjs</span>(path+<span class="string">'qrcode.min.js'</span>, <span class="variable language_">this</span>.<span class="property">wx</span>.<span class="title function_">startQR</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>(2)第二个问题，是生成的微信二维码的div，作者原本是放到了body上，在窗口resize函数执行时，会不停的计算div的位置,重新放置。我觉得应该将二维码div放到相对于微信分享这个按钮的相对位置，让a包裹这个div，这样就可以去掉resize函数的监听。要做这个工作，首先修改了ishare.css，中的.iShare a,添加了position:relative,然后去掉了resize的函数监听，接着修改了setLocation函数，最后将document.body.appendChild(this.wxbox);改为了this.element.appendChild(this.wxbox);我提交了pull request，估计可能作者也没空看，要想看最新的代码，可以看我fork的bibichuan分支<a target="_blank" rel="noopener" href="https://github.com/bibichuan/iShare.js/blob/bibichuan/src/iShare/iShare.js">iShare.js</a></p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/btheme_1.png" lay-src="/posts/48b15d76/btheme_1.png" class="" title="自定义主题">

<p>(3)第三个问题是，假如包裹分享按钮的“iShare-content”容器，刚开始是display:none，那么它就不能正确的识别箭头向上还是向下，如上图，二维码的位置始终是在微信按钮的下方。主要原因是在调用getElementTop()函数时，因为元素是隐藏的，所以获取到的offsetTop始终为零。<br>解决方式就是将创建和显示的位置放在show函数中，当调用显示函数的时候，也就是二维码第一次显示的时候，再创建这个二维码div，其实这样也符合软件开发的原则，如果用户不点击就不创建二维码，这样也算是节省资源。</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/btheme_4.png" lay-src="/posts/48b15d76/btheme_4.png" class="" title="自定义主题">

<p>(4)第四个问题，如果微信二维码的title和tip过长，二维码的位置就会不对。</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/btheme_2.png" lay-src="/posts/48b15d76/btheme_2.png" class="" title="自定义主题">

<p>作者在确定二维码位置时，使用的是获取二维码高度，然后定义top为负值，在操作起来，如果二维码标题太高，在setLocation函数中获取到的_boxH的offsetHeight就不是实际看到的高度，所以，我将定位top改为bottom来确定二维码的位置，详细代码参考github。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">setLocation</span>: <span class="keyword">function</span> (<span class="params">flag</span>) {</span><br><span class="line">	<span class="keyword">var</span> _boxH = <span class="variable language_">this</span>.<span class="property">wxbox</span>.<span class="property">offsetHeight</span>,</span><br><span class="line">		_eW = <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">offsetWidth</span>,</span><br><span class="line">		_eH = <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">offsetHeight</span>,</span><br><span class="line">		_boxStyle = <span class="string">'position:absolute; color: #000;z-index: 99999;'</span>;</span><br><span class="line">	_boxStyle = _boxStyle + <span class="string">'left: '</span> + (_eW / <span class="number">2</span> - <span class="number">12</span>) + <span class="string">'px;'</span>;</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">upDownFlag</span> === <span class="string">'down'</span>) {</span><br><span class="line">		_boxStyle = _boxStyle + <span class="string">'bottom: '</span> + (_eH) + <span class="string">'px;'</span>;</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		_boxStyle = _boxStyle + <span class="string">'top: '</span> + (_eH) + <span class="string">'px;'</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">wxbox</span>.<span class="property">style</span>.<span class="property">cssText</span> = _boxStyle + <span class="variable language_">this</span>.<span class="property">style</span>;</span><br><span class="line">	flag &amp;&amp; (<span class="variable language_">this</span>.<span class="title function_">hide</span>());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>最终的效果就是这样：</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/btheme_3.png" lay-src="/posts/48b15d76/btheme_3.png" class="" title="自定义主题">

<h2 id="2-压缩和美化主题CSS、js和html"><a href="#2-压缩和美化主题CSS、js和html" class="headerlink" title="2.压缩和美化主题CSS、js和html"></a>2.压缩和美化主题CSS、js和html</h2><p>在hexo根目录下安装gulp-clean-css、gulp-uglify、gulp-htmlmin、gulp-htmlclean</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp -g</span><br><span class="line">npm install gulp-clean-css gulp-uglify gulp-htmlmin gulp-htmlclean gulp --save-dev</span><br></pre></td></tr></tbody></table></figure>

<p>编写gulpfile文件</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> minifycss = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">'gulp-htmlmin'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlclean = <span class="built_in">require</span>(<span class="string">'gulp-htmlclean'</span>);</span><br><span class="line"><span class="comment">// 压缩 public 目录 css</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">'minify-css'</span>, <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">'./public/**/*.css'</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">minifycss</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">'./public'</span>));</span><br><span class="line">});</span><br><span class="line"><span class="comment">// 压缩 public 目录 html</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">'minify-html'</span>, <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">'./public/**/*.html'</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">htmlclean</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">htmlmin</span>({</span><br><span class="line">         <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="attr">minifyJS</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="attr">minifyCSS</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="attr">minifyURLs</span>: <span class="literal">true</span>,</span><br><span class="line">    }))</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">'./public'</span>))</span><br><span class="line">});</span><br><span class="line"><span class="comment">// 压缩 public/js 目录 js</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">'minify-js'</span>, <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">'./public/**/*.js'</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">'./public'</span>));</span><br><span class="line">});</span><br><span class="line"><span class="comment">// 执行 gulp 命令时执行的任务</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">'default'</span>, [</span><br><span class="line">    <span class="string">'minify-html'</span>,<span class="string">'minify-css'</span>,<span class="string">'minify-js'</span></span><br><span class="line">]);</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<div class="reference">参考文章：<br>1.<a target="_blank" rel="noopener" href="https://juejin.im/entry/5b3b6c15f265da0f800db86a">使用gulp打包压缩完整项目</a></div>
<p><strong>注意事项</strong><br>我在使用gulp-htmlmin过程中，出现了一个奇怪的问题</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/minify-html_1.png" lay-src="/posts/48b15d76/minify-html_1.png" class="" title="gulp-htmlmin问题">

<p>找来找去，我才发现了一个基本的问题，“ &lt;!doctype&gt;声明必须处于HTML文档的头部，在<code>&lt;html&gt;</code>标签之前，HTML5中不区分大小写….”,这个提示确实是正确的,因为我在html中确实出现了一个&lt;!doctype&gt;,这个应该放到文档开头，如果非得使用这个标签，就用  <code>&amp;lt;!doctype&amp;gt;</code>  代替,这也算是html基本的知识。</p>
<div class="reference">参考文章：<br>1.<a target="_blank" rel="noopener" href="http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html">hexo的next主题个性化教程:打造炫酷网站</a><br>2.<a target="_blank" rel="noopener" href="https://blog.csdn.net/L_201607/article/details/81097278">Hexo 博客添加各种有趣又有用的小功能</a></div>
<h2 id="3-自定义主题中的css目录"><a href="#3-自定义主题中的css目录" class="headerlink" title="3.自定义主题中的css目录"></a>3.自定义主题中的css目录</h2><p>在自定义主题中编写css,如果文件夹的名字中开头是一个短杠，则hexo不主动处理其中的文件和文件夹，类似于私有的一样，除非在css根目录中某个.styl文件中使用import显示的引入其中的文件，比如在main.styl文件中引用到了_common文件夹中的文件，hexo就会主动去处理，并合并到main.css中，如果没有其他文件引入，在css/_page中的文件将不会被处理，也不会在最终生成的public文件中出现。</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/hexo_theme_1.png" lay-src="/posts/48b15d76/hexo_theme_1.png" class="" title="自定义主题中的css文件">

<p>假如css下的某个文件夹没有短线，即使没有其他的文件引入其中的文件，在hexo也会主动处理其中的styl文件，并最终会复制到public中的css文件夹中,例如此处的p文件夹下的anime.styl文件会被处理。</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/hexo_theme_2.png" lay-src="/posts/48b15d76/hexo_theme_2.png" class="" title="自定义主题中的css文件">

<p>最终会在public文件夹的css文件夹中生成p文件夹</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/hexo_theme_2.png" lay-src="/posts/48b15d76/hexo_theme_2.png" class="" title="自定义主题中的css文件">

<p>同理，对于主题的模板文件layout文件夹也是如此处理。</p>
<h2 id="4-图片懒加载"><a href="#4-图片懒加载" class="headerlink" title="4.图片懒加载"></a>4.图片懒加载</h2><p>图片懒加载的意思，就是说图片看不见的时候，就不让他加载，等页面滚动到图片所在位置时在进行加载。主要原理是，在html的图片标签上先不对src进行赋值，通过另一个属性比如lay-src，或其他属性标志图片的地址，等页面滚动到图片所在位置时，通过js将img的src修改为图片的真实地址。在next主题中使用了hexo-lazyload-image插件,主要有两步：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.在hexo after_post_render事件或者after_render:html事件里将生产出来的文章html代码中所有img元素都加上 data-original 属性，并把src值付给他， 然后在将src值致为loading图片</span><br><span class="line">2.注入simple-lazyload脚本在每个页面最后面，当页面加载过后负责判定当前需要重新加载的图片。</span><br></pre></td></tr></tbody></table></figure>

<p>安装的插件主要负责第一步操作，脚步的注入需要自己手动插入。</p>
<p>在我的主题中，因为我使用了layui这个组件库，所以我借助了layui提供的图片懒加载模式，当然第一步的after_post_render还是要自己手工写的，然后就是调用layui的flow插件即可。(自己写的时候，有点上当了，在主题的模板文件中，我用的是post.more渲染的文章内容，而不是post.content，所有我无论怎么改conten的内容，刷新页面都还是原样，倒腾了一下午，没找到原因，最后发现我修改了data.content,渲染文章的时候用的是data.more，所以看不出代码写的对不对),最后的代码如下：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//主要进行图片的处理</span></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">'after_post_render'</span>, <span class="keyword">function</span>(<span class="params">data</span>){</span><br><span class="line">  <span class="comment">//将图片的src属性全部替换为lay-src属性，方便进行懒加载</span></span><br><span class="line">  <span class="keyword">var</span> root=hexo.<span class="property">config</span>.<span class="property">root</span>;</span><br><span class="line">  <span class="keyword">if</span>(root[root.<span class="property">length</span>-<span class="number">1</span>]!=<span class="string">'/'</span>){</span><br><span class="line">      root=root+<span class="string">"/"</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">var</span> name=hexo.<span class="property">theme</span>.<span class="property">config</span>.<span class="property">loadingImage</span>;</span><br><span class="line">  <span class="keyword">if</span>(!name||name==<span class="string">""</span>){</span><br><span class="line">    name=<span class="string">"loadimg.png"</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">var</span> loadingImage=hexo.<span class="property">config</span>.<span class="property">root</span>+hexo.<span class="property">theme</span>.<span class="property">config</span>.<span class="property">images</span>+<span class="string">"/"</span>+name;</span><br><span class="line">  data.<span class="property">content</span>=content.<span class="title function_">replace</span>(<span class="regexp">/&lt;img(\s*?)src="(.*?)"(.*?)&gt;/gi</span>, <span class="keyword">function</span> (<span class="params">str, p1, p2</span>) {</span><br><span class="line">      <span class="keyword">return</span> str.<span class="title function_">replace</span>(p2, loadingImage + <span class="string">'" lay-src="'</span> + p2);</span><br><span class="line">  });</span><br><span class="line">  data.<span class="property">more</span>=data.<span class="property">more</span>.<span class="title function_">replace</span>(<span class="regexp">/&lt;img(\s*?)src="(.*?)"(.*?)&gt;/gi</span>, <span class="keyword">function</span> (<span class="params">str, p1, p2</span>) {</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">replace</span>(p2, loadingImage + <span class="string">'" lay-src="'</span> + p2);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>我发现了一个问题，就是在没有执行代码之前，懒加载的图片会变成没有图片，那种加载错误的样子,就是没有图片占位符，显示的是裂图，这里有<a target="_blank" rel="noopener" href="https://fly.layui.com/jie/45559/">解决方案</a>，首先是修改<code>&lt;img src="loading.gif" lay-src="img.jpg"&gt;</code>，然后修改js文件。我试了下，虽然有三种方法，但是第一种不太好，删除之后，每滚动下，就会去加载一个undefine图片，第二种就没有这个问题，即将文件lay/modules/flow.js 中的&amp;&amp;!e.attr(“src”)改为&amp;&amp;e.attr(“lay-src”)，希望官方能今早解决这个占位图的问题吧。</p>
<div class="reference">参考文章：<br>1.<a target="_blank" rel="noopener" href="https://troyyang.com/2017/08/06/hexo-lazyload-image/">Hexo-lazyload-image图片懒加载</a><br>2.<a target="_blank" rel="noopener" href="https://medium.com/@filipvitas/lazy-load-images-with-zero-javascript-2c5bcb691274">Lazy load images with zero Javascript</a><br>3.<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008787668">js–string/正则表达式replace方法详解</a></div>
<p>还有一个问题就是，虽然图片是正常的实现了懒加载，但是fancybox3的图片放大问题也同时出现了，点击fancybox3时，出现的图片不能识别lay-src里面的属性，而src这个时候的值，可能还没有或者是还只是一个占位符。<br>这个问题的解决方式，在于fancybox3的图片加载，可以不仅仅使用src，而是可以从其包裹的a标签中修改，在img标签上添加data-original属性是重点</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fancybox3 显示图片代码</span></span><br><span class="line">$(<span class="string">'.post img'</span>)</span><br><span class="line">	.<span class="title function_">not</span>(<span class="string">'[hidden]'</span>)</span><br><span class="line">	.<span class="title function_">not</span>(<span class="string">'.group-picture img, .post-gallery img'</span>)</span><br><span class="line">	.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">	<span class="keyword">var</span> $image = $(<span class="variable language_">this</span>);</span><br><span class="line">	<span class="keyword">var</span> imageTitle = $image.<span class="title function_">attr</span>(<span class="string">'title'</span>);</span><br><span class="line">	<span class="keyword">var</span> $imageWrapLink = $image.<span class="title function_">parent</span>(<span class="string">'a'</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ($imageWrapLink.<span class="property">length</span> &lt; <span class="number">1</span>) {</span><br><span class="line">		<span class="keyword">var</span> imageLink = $image.<span class="title function_">attr</span>(<span class="string">'data-original'</span>) ? <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">'data-original'</span>) : <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">'src'</span>);</span><br><span class="line">		$imageWrapLink = $image.<span class="title function_">wrap</span>(<span class="string">'&lt;a data-fancybox="group" href="'</span> + imageLink + <span class="string">'"&gt;&lt;/a&gt;'</span>).<span class="title function_">parent</span>(<span class="string">'a'</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	$imageWrapLink.<span class="title function_">addClass</span>(<span class="string">'fancybox fancybox.image'</span>);</span><br><span class="line">	$imageWrapLink.<span class="title function_">attr</span>(<span class="string">'rel'</span>, <span class="string">'group'</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (imageTitle) {</span><br><span class="line">		<span class="comment">//$imageWrapLink.append('&lt;p class="image-caption"&gt;' + imageTitle + '&lt;/p&gt;');</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//make sure img title tag will show correctly in fancybox</span></span><br><span class="line">		$imageWrapLink.<span class="title function_">attr</span>(<span class="string">'title'</span>, imageTitle);</span><br><span class="line">	}</span><br><span class="line">	});</span><br><span class="line">$(<span class="string">'.fancybox'</span>).<span class="title function_">fancybox</span>({</span><br><span class="line">	<span class="attr">backFocus</span>:<span class="literal">false</span></span><br><span class="line">	,<span class="attr">hash</span>: <span class="literal">false</span></span><br><span class="line">	,<span class="attr">hideScrollbar</span>:<span class="literal">false</span></span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">//after_post_render代码</span></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">'after_post_render'</span>, <span class="keyword">function</span>(<span class="params">data</span>){</span><br><span class="line">  <span class="keyword">let</span> content=data.<span class="property">content</span>;</span><br><span class="line">  <span class="comment">//将图片的src属性全部替换为lay-src属性，方便进行懒加载</span></span><br><span class="line">  <span class="keyword">var</span> root=hexo.<span class="property">config</span>.<span class="property">root</span>;</span><br><span class="line">  <span class="keyword">if</span>(root[root.<span class="property">length</span>-<span class="number">1</span>]!=<span class="string">'/'</span>){</span><br><span class="line">      root=root+<span class="string">"/"</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">var</span> name=hexo.<span class="property">theme</span>.<span class="property">config</span>.<span class="property">loadingImage</span>;</span><br><span class="line">  <span class="keyword">if</span>(!name||name==<span class="string">""</span>){</span><br><span class="line">    name=<span class="string">"loadimg.png"</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">var</span> loadingImage=hexo.<span class="property">config</span>.<span class="property">root</span>+hexo.<span class="property">theme</span>.<span class="property">config</span>.<span class="property">images</span>+<span class="string">"/"</span>+name;</span><br><span class="line">  <span class="comment">//添加data-original属性是重点</span></span><br><span class="line">  data.<span class="property">content</span>=content.<span class="title function_">replace</span>(<span class="regexp">/&lt;img(\s*?)src="(.*?)"(.*?)&gt;/gi</span>, <span class="keyword">function</span> (<span class="params">str, p1, p2</span>) {</span><br><span class="line">      <span class="keyword">return</span> str.<span class="title function_">replace</span>(p2, loadingImage + <span class="string">'" data-original="'</span>+p2+<span class="string">'" lay-src="'</span> + p2);</span><br><span class="line">  });</span><br><span class="line">  <span class="comment">//添加data-original属性是重点</span></span><br><span class="line">  data.<span class="property">more</span>=data.<span class="property">more</span>.<span class="title function_">replace</span>(<span class="regexp">/&lt;img(\s*?)src="(.*?)"(.*?)&gt;/gi</span>, <span class="keyword">function</span> (<span class="params">str, p1, p2</span>) {</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">replace</span>(p2, loadingImage + <span class="string">'" data-original="'</span>+p2+<span class="string">'" lay-src="'</span> + p2);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<h2 id="5-使用github作为自己的图床"><a href="#5-使用github作为自己的图床" class="headerlink" title="5.使用github作为自己的图床"></a>5.使用github作为自己的图床</h2><p>网上有很多图床，主要的作用就是存储图片，然后发布一个链接，在自己的应用中使用图片链接。主要问题是，都有这样那样的限制，像七牛云，虽然有10G的免费空间，但是它一个月后就把测试域名回收了，必须绑定自己的已经备案的域名（要是我能备案，就这点图片，还用得着放在免费的地方吗？），我自己就吃了这个亏，最后放到七牛云上的图片，也下载不下来了。因为没有自己的域名，连下载都不让下载了。其他的一些，也都是限制数量啊，限制带宽啊，绑定域名啊，感觉有些不方便。后来我想过了，其实可以用github，直接载自己的hexo中存储图片，当作图床。步骤如下：</p>
<p>新建一个页面：hexo new page photo,目的就是在source下生成一个photo文件夹，然后把里面生成的index文件夹和index.md文件删除，只留下一个空的文件夹，hexo在打包生成网站的时候，会原封不动的将这个文件夹里面的内容拷贝到public目录下，通过网站地址，就可以访问到了，比如我的网站是放到github上的，就可以使用: <code>https://bibichuan.github.io/photo/&gt;</code> 访问这个文件夹里面的文件了，然后把自己的图片放到这个文件夹里，在需要引用的时候，使用绝对网络路径，或者相对路径都是可以的。我这里使用的是相对路径，例如：我在 <code>https://bibichuan.github.io/anmie</code> 这个页面中图片地址，就可以使用”../photo/anime/0%E5%8F%B7%E5%AE%BF%E8%88%8D_1.webp”</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/photo_1.png" lay-src="/posts/48b15d76/photo_1.png" class="" title="图床">

<p>妈妈再也不用担心我的图片存放问题了。</p>
<p>当然了，使用这种方式，肯定是不利于CDN加速的，如果将大量图片放到自己的图片上，也相应的会增加自己服务器的压力。但是这都没关系，反正我现在只是把网站架在了github上，先要重复利用资源。</p>
<div class="reference">参考文章：<br>1.<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/35270383">盘点一下免费好用的图床</a></div>
<h2 id="6-将分类和标签进行首字母大写"><a href="#6-将分类和标签进行首字母大写" class="headerlink" title="6.将分类和标签进行首字母大写"></a>6.将分类和标签进行首字母大写</h2><p>需求主要是这样的，在我的主题中，我将文章的分类抽取出来形成了网站的菜单栏，但是有时候我会将分类写错，比如同时写了大小写不同而类型相同的两个类别，Java和java我的本意应该属于同一类，但是由于大小写的关系，它们被分成了两类，放在了不同的文件目录中。于是我突发奇想，能不能把两者合并成一种呢？比如都变成以大小字母开头的类别。刚开始我想着是使用nodejs读取文件，然后将字母进行替换，但是这有个问题，我虽然可以读取文件，但是专门处理文章的分类而不处理文章的内容，比较麻烦，而我又不会正则表达式。</p>
<p><strong>(最新进展，我发现了两个好用的工具hexo-front-matter和gray-matter,可以将md头部元数据信息直接转换成对象的形式，这样就可以直接操作文件了，例子请看第八节)</strong></p>
<p>然后我还尝试了在过滤器中before_post_render对文章进行修改，虽然可以将data修改为想要的类别，但是始终应用不到网页中，后来我相通了，调用before_post_render过滤器时，文章的目录其实已经生成了，这个时候在修改文章的类别，不能同时应用于文章生成后的目录上去了。</p>
<p><strong>如何生成tag标签页，可以参考我的另一篇文章 <a href="/posts/ff9c4413.html" title="Hexo自定义主题（四）">Hexo自定义主题（四）</a> 第五节</strong></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文章渲染前进行操作</span></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">'before_post_render'</span>, <span class="keyword">function</span>(<span class="params">data</span>){</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  <span class="comment">// data.title = data.title.toLowerCase();</span></span><br><span class="line">  <span class="keyword">var</span> categories=data.<span class="property">categories</span>.<span class="property">data</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> menuItem <span class="keyword">in</span> categories){</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(menuItem);</span><br><span class="line">    <span class="keyword">let</span> name=categories[menuItem].<span class="property">name</span>;</span><br><span class="line">    <span class="comment">//将首字母改为大写</span></span><br><span class="line">    name=name.<span class="title function_">toLowerCase</span>().<span class="title function_">replace</span>(<span class="regexp">/( |^)[a-z]/g</span>, <span class="function">(<span class="params">L</span>) =&gt;</span> L.<span class="title function_">toUpperCase</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">    categories[menuItem].<span class="property">name</span>=name;</span><br><span class="line">    data.<span class="property">categories</span>.<span class="property">data</span>[menuItem].<span class="property">name</span>=<span class="string">"dd"</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">categories</span>);</span><br><span class="line">  data.<span class="property">title</span> = data.<span class="property">title</span>.<span class="title function_">toLowerCase</span>();</span><br><span class="line">  data.<span class="property">categories</span>=categories;</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hexo.<span class="property">locals</span>);</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">processor</span>.<span class="title function_">register</span>(<span class="string">"_posts/*.md"</span>, <span class="keyword">function</span>(<span class="params">file</span>){</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(file);</span><br><span class="line">  fs.<span class="title function_">readFile</span>(file.<span class="property">source</span>,{<span class="attr">encoding</span>:<span class="string">'utf8'</span>},<span class="keyword">function</span>(<span class="params">err,files</span>){</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(files)</span><br><span class="line">    <span class="keyword">var</span> result = files.<span class="title function_">replace</span>(<span class="regexp">/要替换的内容/g</span>, <span class="string">'替换后的内容'</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(files);</span><br><span class="line"></span><br><span class="line">    fs.<span class="title function_">writeFile</span>(<span class="string">'./js/'</span>+item, result, <span class="string">'utf8'</span>, <span class="keyword">function</span> (<span class="params">err</span>) {</span><br><span class="line">         <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">  })</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>最后的解决方式是，用生成器去处理，在生成每一篇文章的时候，直接将其分类改掉，虽然磁盘上的文件的分类还是原先的，但是发布到网上的文章分类不会出现大小写问题造成的分类不一致的问题了。代码如下：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文章渲染前进行操作,将分类和tags标签改为首字母大写</span></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">generator</span>.<span class="title function_">register</span>(<span class="string">'post'</span>, <span class="keyword">function</span>(<span class="params">locals</span>){</span><br><span class="line">  <span class="keyword">return</span> locals.<span class="property">posts</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">post</span>){</span><br><span class="line">    <span class="comment">// 修改分类为首字母大写</span></span><br><span class="line">    <span class="keyword">var</span> categories=post.<span class="property">categories</span>.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> menuItem <span class="keyword">in</span> categories){</span><br><span class="line">      <span class="keyword">let</span> name=categories[menuItem].<span class="property">name</span>;</span><br><span class="line">      <span class="comment">//将首字母改为大写</span></span><br><span class="line">      name=name.<span class="title function_">toLowerCase</span>().<span class="title function_">replace</span>(<span class="regexp">/( |^)[a-z]/g</span>, <span class="function">(<span class="params">L</span>) =&gt;</span> L.<span class="title function_">toUpperCase</span>());</span><br><span class="line">      categories[menuItem].<span class="property">name</span>=name;</span><br><span class="line">      post.<span class="property">categories</span>.<span class="property">data</span>[menuItem].<span class="property">name</span>=name;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//修改标签为首字母大写</span></span><br><span class="line">    <span class="keyword">var</span> tags=post.<span class="property">tags</span>.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> menuItem <span class="keyword">in</span> tags){</span><br><span class="line">      <span class="keyword">let</span> name=tags[menuItem].<span class="property">name</span>;</span><br><span class="line">      <span class="comment">//将首字母改为大写</span></span><br><span class="line">      name=name.<span class="title function_">toLowerCase</span>().<span class="title function_">replace</span>(<span class="regexp">/( |^)[a-z]/g</span>, <span class="function">(<span class="params">L</span>) =&gt;</span> L.<span class="title function_">toUpperCase</span>());</span><br><span class="line">      tags[menuItem].<span class="property">name</span>=name;</span><br><span class="line">      post.<span class="property">tags</span>.<span class="property">data</span>[menuItem].<span class="property">name</span>=name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">path</span>: post.<span class="property">path</span>,</span><br><span class="line">      <span class="attr">data</span>: post,</span><br><span class="line">      <span class="attr">layout</span>: <span class="string">'post'</span></span><br><span class="line">    };</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>生成标签列表时使用自定义的变量进行生成</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">'template_locals'</span>, <span class="keyword">function</span>(<span class="params">locals</span>){</span><br><span class="line">  <span class="comment">//修改标签，合并同类标签，</span></span><br><span class="line">  <span class="keyword">let</span> tags=hexo.<span class="property">locals</span>.<span class="title function_">get</span>(<span class="string">"tags"</span>).<span class="property">data</span>;</span><br><span class="line">  <span class="keyword">let</span> tagsName=[];</span><br><span class="line">  <span class="keyword">let</span> newTags=[];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> menuItem <span class="keyword">in</span> tags){</span><br><span class="line">    <span class="keyword">let</span> name=tags[menuItem].<span class="property">name</span>;</span><br><span class="line">    <span class="comment">//console.log(tags[menuItem]);</span></span><br><span class="line">    <span class="comment">//将首字母改为大写</span></span><br><span class="line">    name=name.<span class="title function_">toLowerCase</span>().<span class="title function_">replace</span>(<span class="regexp">/( |^)[a-z]/g</span>, <span class="function">(<span class="params">L</span>) =&gt;</span> L.<span class="title function_">toUpperCase</span>());</span><br><span class="line">    <span class="keyword">if</span>(tagsName.<span class="title function_">indexOf</span>(name)&lt;<span class="number">0</span>&amp;&amp;name!=<span class="literal">null</span>&amp;&amp;name!=<span class="string">""</span>){</span><br><span class="line">      tagsName.<span class="title function_">push</span>(name);</span><br><span class="line">      tags[menuItem].<span class="property">name</span>=name;</span><br><span class="line">      tags[menuItem].<span class="property">path</span>=<span class="string">"/tags/"</span>+name+<span class="string">"/"</span>;</span><br><span class="line">      newTags.<span class="title function_">push</span>(tags[menuItem]);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  locals.<span class="property">newTags</span>=newTags;</span><br><span class="line">  <span class="keyword">return</span> locals;</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<div class="reference">参考文章：<br>1.<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/api/generator">生成器（Generator）</a><br>2.<a target="_blank" rel="noopener" href="https://github.com/jonschlinkert/gray-matter">gray-matter</a><br>3.<a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo-front-matter">hexo-front-matter</a><br>4.<a target="_blank" rel="noopener" href="https://juejin.im/entry/58c63c5061ff4b005d9f7a62">大前端 - 5 分钟带你读懂 Hexo 源码设计模式</a></div>
<p><strong>更新后</strong><br>上面的代码，我发现了通过修改template_locals过滤器，会连草稿箱中标签也算在内，所以最新的内容请查看 <a href="/posts/ff9c4413.html" title="Hexo自定义主题（四）">Hexo自定义主题（四）</a> 第五章。</p>
<h2 id="7-奇怪的标签"><a href="#7-奇怪的标签" class="headerlink" title="7.奇怪的标签"></a>7.奇怪的标签</h2><p>我在更新代码的时候，不知道为何，输出的文章标签永远都是这几个。</p>


<p>我始终怀疑是vscode缓存的问题。因为我查看了多篇md文章，里面的标签明明不一样，而且，我每次更新一篇文章的时候，都会有新的标签加进来，即便是我只是在这篇文章中添加了一个空格，这篇文章也是能将这个标签加载进来的。最后的解决方法，还是我删除了整个网站，重新clone，然后重新运行了hexo s。</p>
<h2 id="8-代码处理md文件"><a href="#8-代码处理md文件" class="headerlink" title="8.代码处理md文件"></a>8.代码处理md文件</h2><p>需求注意是在第六部分中提到的，将分类和标签的首字母大写，可以通过nodejs读取每一篇文章，经过处理后，再写回去，这样就实现了可以将文章的标签和分类分别处理的功能了。这里主要用到了gray-matter这个npm插件，安装方式：npm install gray-matter –save或者是cnpm install gray-matter –save，处理文章的代码如下：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// npm install moment --save</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rf=<span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> grey_matter=<span class="built_in">require</span>(<span class="string">"gray-matter"</span>);</span><br><span class="line"><span class="keyword">var</span> moment=<span class="built_in">require</span>(<span class="string">"moment"</span>);</span><br><span class="line"></span><br><span class="line">rf.<span class="title function_">readFile</span>(<span class="string">"Git和GitHub.md"</span>,<span class="string">'utf-8'</span>,<span class="keyword">function</span>(<span class="params">err,data</span>){</span><br><span class="line">    <span class="keyword">if</span>(err){</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        <span class="keyword">var</span> obj=<span class="title function_">grey_matter</span>(data);</span><br><span class="line">        <span class="keyword">var</span> titleObj=obj.<span class="property">data</span>;</span><br><span class="line">        titleObj.<span class="property">tags</span>=<span class="string">"k"</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(titleObj.<span class="property">date</span>);</span><br><span class="line">        <span class="keyword">var</span> d=<span class="title function_">moment</span>(titleObj.<span class="property">date</span>).<span class="title function_">format</span>(<span class="string">'YYYY-MM-DD hh:mm:ss'</span>);</span><br><span class="line">        titleObj.<span class="property">date</span>=d;</span><br><span class="line"></span><br><span class="line">        rf.<span class="title function_">writeFile</span>(<span class="string">"test.md"</span>, obj.<span class="title function_">stringify</span>(), <span class="keyword">function</span>(<span class="params">error</span>){</span><br><span class="line">            <span class="keyword">if</span>(err){</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'写文件操作成功'</span>);</span><br><span class="line">            } </span><br><span class="line">        })</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>安装moment，是为了处理文章的日常，grey_matter将日期读取为UTC格式，然后将其格式化后重新写入文件。这里有些小瑕疵，就是原始文件中的日期是没有单引号的</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/grey_matter_1.png" lay-src="/posts/48b15d76/grey_matter_1.png" class="" title="grey_matter使用">

<p>重新格式化后回写，就出现了单引号：</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/grey_matter_2.png" lay-src="/posts/48b15d76/grey_matter_2.png" class="" title="grey_matter使用">

<p>这不影响大局，但是对于强迫症患者，还是无法忍受的(算了，不管了，反正不影响使用)。当然，你不对日期进行处理，那么它回写回去的就是UTC时间</p>
<img src="/images/loadimg.png" data-original="/posts/48b15d76/grey_matter_3.png" lay-src="/posts/48b15d76/grey_matter_3.png" class="" title="grey_matter使用">

<p>最后，配合hexo的处理去，就可以对每一篇文章进行处理后，原封不动的再写回去了。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">hexo.<span class="property">extend</span>.<span class="property">processor</span>.<span class="title function_">register</span>(<span class="string">"_posts/*.md"</span>, <span class="keyword">function</span>(<span class="params">file</span>){</span><br><span class="line">  fs.<span class="title function_">readFile</span>(file.<span class="property">source</span>,{<span class="attr">encoding</span>:<span class="string">'utf8'</span>},<span class="keyword">function</span>(<span class="params">err,files</span>){</span><br><span class="line">    <span class="keyword">var</span> obj=<span class="title function_">grey_matter</span>(files);</span><br><span class="line">    <span class="keyword">var</span> titleObj=obj.<span class="property">data</span>;</span><br><span class="line">    titleObj.<span class="property">tags</span>=<span class="string">"k"</span>;</span><br><span class="line">    <span class="keyword">var</span> d=<span class="title function_">moment</span>(titleObj.<span class="property">date</span>).<span class="title function_">format</span>(<span class="string">'YYYY-MM-DD hh:mm:ss'</span>);</span><br><span class="line">    titleObj.<span class="property">date</span>=d;</span><br><span class="line"></span><br><span class="line">    rf.<span class="title function_">writeFile</span>(file.<span class="property">source</span>, obj.<span class="title function_">stringify</span>(), <span class="keyword">function</span>(<span class="params">error</span>){</span><br><span class="line">        <span class="keyword">if</span>(err){</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'写文件操作成功'</span>);</span><br><span class="line">        } </span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">  })</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></body></html>
              </div>
            </div>
          </div>
          <div class='post-footer'>
            <div>**本文已结束，感谢您的观看**</div>
            <div class="btn btn-pay">鼓励一下</div>
          </div>
          
            <div class="page">
              
              <section class="past-wrap">
                <section class="past">
                <p>往期推荐</p>
                </section>
              </section>
              <div class="post-nav">
                <div class="post-nav-next post-nav-item">
                  
                    <a href="/posts/5affe24.html" rel="next" title="Hexo自定义主题（二）">
                      <i class="iconfont icon-prev"></i> Hexo自定义主题（二）
                    </a>
                  
                </div>

                <span class="post-nav-divider"></span>

                <div class="post-nav-prev post-nav-item">
                  
                    <a href="/posts/37ca5940.html" rel="prev" title="Hexo 自定义主题">
                      Hexo 自定义主题 <i class="iconfont icon-next"></i>
                    </a>
                  
                </div>
              </div>
            </div>
          
          
 <div class="comments" id="comments">
    <div id="disqus_thread">
        <noscript>
            不支持Javascript,那你还上啥网啊。
            <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript"></a>
        </noscript>
    </div>
</div>

      </div>
    </div>


    <div class="layui-col-md2 layui-col-lg2 layui-col-sm10 layui-col-xs12 catalogue-wrap">
        

<div class="catalogue-content">
    <div class="title">文章目录</div>
    <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%B7%BB%E5%8A%A0%E5%88%86%E4%BA%AB"><span class="toc-number">1.</span> <span class="toc-text">1.添加分享</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5iconfont%E3%80%81css%E5%92%8Cjs"><span class="toc-number">1.1.</span> <span class="toc-text">引入iconfont、css和js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9iShare"><span class="toc-number">1.2.</span> <span class="toc-text">修改iShare</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%8E%8B%E7%BC%A9%E5%92%8C%E7%BE%8E%E5%8C%96%E4%B8%BB%E9%A2%98CSS%E3%80%81js%E5%92%8Chtml"><span class="toc-number">2.</span> <span class="toc-text">2.压缩和美化主题CSS、js和html</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%BB%E9%A2%98%E4%B8%AD%E7%9A%84css%E7%9B%AE%E5%BD%95"><span class="toc-number">3.</span> <span class="toc-text">3.自定义主题中的css目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">4.</span> <span class="toc-text">4.图片懒加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BD%BF%E7%94%A8github%E4%BD%9C%E4%B8%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9B%BE%E5%BA%8A"><span class="toc-number">5.</span> <span class="toc-text">5.使用github作为自己的图床</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%B0%86%E5%88%86%E7%B1%BB%E5%92%8C%E6%A0%87%E7%AD%BE%E8%BF%9B%E8%A1%8C%E9%A6%96%E5%AD%97%E6%AF%8D%E5%A4%A7%E5%86%99"><span class="toc-number">6.</span> <span class="toc-text">6.将分类和标签进行首字母大写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%A5%87%E6%80%AA%E7%9A%84%E6%A0%87%E7%AD%BE"><span class="toc-number">7.</span> <span class="toc-text">7.奇怪的标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E4%BB%A3%E7%A0%81%E5%A4%84%E7%90%86md%E6%96%87%E4%BB%B6"><span class="toc-number">8.</span> <span class="toc-text">8.代码处理md文件</span></a></li></ol>
    </div>
</div>


        <div class="sidecontent">

    

    <div class="side-panel side-sponsor">
        <div class="side-title one">小额赞助</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">本人提供免费与付费咨询服务，感谢您的支持！赞助请发邮件通知，方便公布您的善意！</div>
                <div class="content">
                    <img src="/images/pay.png" title="小额赞助"/>
                </div>
                
                
                <div class="donor_content">
                    
                        
                        <div class="donor-item">
                            <span class="name">**光</span>
                            <span class="money">3.01 元</span>
                        </div>
                    
                        
                        <div class="donor-item">
                            <span class="name">Sun</span>
                            <span class="money">3.00 元</span>
                        </div>
                    
                        
                        <div class="donor-item">
                            <span class="name">bibichuan</span>
                            <span class="money">3.00 元</span>
                        </div>
                    
                    <div class="donor_footer">
                        <span>捐赠者名单</span>
                        <span class="total">合计：9.01 元</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="side-ad side-panel">
        <div class="side-title two">微信公众号</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <img src="/images/wechat.png" title="公众号"/>
            </div>
        </div>
    </div>

    <div class="side-ad side-panel">
        <div class="side-title one">广告位</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">诚心邀请广大金主爸爸洽谈合作</div>
                <div class="detail">
                </div>
            </div>
        </div>
    </div>

    <div class="side-ask side-panel">
        
        <div class="side-title two">每日一省</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">isNaN 和 Number.isNaN 函数的区别？</div>
                <div class="detail">
                    
                        <p>1.函数 isNaN 接收参数后，会尝试将这个参数转换为数值，任何不能被转换为数值的的值都会返回 true，因此非数字值传入也会返回 true ，会影响 NaN 的判断。</p>
                    
                        <p>2.函数 Number.isNaN 会首先判断传入参数是否为数字，如果是数字再继续判断是否为 NaN ，不会进行数据类型的转换，这种方法对于 NaN 的判断更为准确。</p>
                    
                </div>
            </div>
            <div class="side-footer">
                <span class="side-footer-item time">2021-04-07</span>
                
                    <span class="side-footer-item side-button down" title="查看答案">
                        <i class="iconfont icon-expansion"></i>
                    </span>
                
                
                    <a class="side-footer-item side-button answer-url" href="https://juejin.cn/post/6940945178899251230"
                    target="_blank">链接地址</a>
                
            </div>
        </div>
    </div>
    <div class="side-ask side-panel">
        
        <div class="side-title three">每日二省</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">为什么0.1+0.2 ! == 0.3，如何让其相等?</div>
                <div class="detail">
                     
                        <p>一个直接的解决方法就是设置一个误差范围，通常称为“机器精度”。对JavaScript来说，这个值通常为2-52，在ES6中，提供了Number.EPSILON属性，而它的值就是2-52，只要判断0.1+0.2-0.3是否小于Number.EPSILON，如果小于，就可以判断为0.1+0.2 ===0.3。</p>
                    
                </div>
            </div>
            <div class="side-footer">
                <span class="side-footer-item time">2021-04-07</span>
                
                    <span class="side-footer-item side-button down" title="查看答案">
                        <i class="iconfont icon-expansion"></i>
                    </span>
                
                
                    <a class="side-footer-item side-button answer-url" href="https://juejin.cn/post/6940945178899251230#heading-8"
                    target="_blank">链接地址</a>
                
            </div>
        </div>
    </div>
    <div class="side-ask side-panel">
        
        <div class="side-title three">每日三省</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">== 操作符的强制类型转换规则？</div>
                <div class="detail">
                     
                        <p>1.首先会判断两者类型是否**相同，**相同的话就比较两者的大小。</p>
                    
                        <p>2.类型不相同的话，就会进行类型转换。</p>
                    
                        <p>3.会先判断是否在对比 null 和 undefined，是的话就会返回 true。</p>
                    
                        <p>4.判断两者类型是否为 string 和 number，是的话就会将字符串转换为 number。</p>
                    
                        <p>5.判断其中一方是否为 boolean，是的话就会把 boolean 转为 number 再进行判断。</p>
                    
                        <p>6.判断其中一方是否为 object 且另一方为 string、number 或者 symbol，是的话就会把 object 转为原始类型再进行判断。</p>
                    
                </div>
            </div>
            <div class="side-footer">
                <span class="side-footer-item time">2021-04-07</span>
                
                    <span class="side-footer-item side-button down" title="查看答案">
                        <i class="iconfont icon-expansion"></i>
                    </span>
                
                
                    <a class="side-footer-item side-button answer-url" href="https://juejin.cn/post/6940945178899251230#heading-12"
                    target="_blank">链接地址</a>
                
            </div>
        </div>
    </div>
    <div class="side-ask side-panel">
        
        <div class="side-title two">每日英语</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">Happiness is time precipitation, smile is the lonely sad.</div>
                <div class="detail">幸福是年华的沉淀，微笑是寂寞的悲伤。</div>
            </div>
            <div class="side-footer">
                <span class="side-footer-item time">2016</span>
                
                    <span class="side-footer-item side-button down" title="查看翻译">
                        <i class="iconfont icon-expansion"></i>
                    </span>
                
                <span class="side-footer-item author">——— 美文</span>
            </div>
        </div>
    </div>

</div>
    </div>

  </div>
  <div class="side-tool">
    <div class="side-icon-wrap">
        <i class="iconfont icon-sidemenu"></i>
    </div>
    <ul class="side-tool-content">
        <li title="回到顶部" class="back-to-top side-tool-item">
            <a class="function-button"><i class="iconfont icon-backtop"></i></a>
        </li> 
        <li title="分享文章" class="side-share side-tool-item">
            <a class="function-button"><i class="iconfont icon-share"></i></a>
            <div class="iShare iShare-content"></div>
        </li>
        <li title="喜欢文章" class="side-like side-tool-item">
            <a class="function-button"><i class="iconfont icon-like"></i></a>
        </li>
         <li class="side-close" title="关闭侧边栏">
            <a class="function-button"><i class="iconfont icon-close"></i></a>
        </li>
    </ul>
</div>

      </div>
    </main>   
    
    <footer id="footer" class="footer layui-fluid">
      <div class="layui-row">
        <div class="container footer-inner">
          <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="footer-col">
  <div>温馨提示</div>
  <div><a href="/about" target="_self">关于作者</a></div>
  <div><a href="/archives">博客归档</a></div>
  <div>
    <span id="busuanzi_container_site_uv">
      访客数<span id="busuanzi_value_site_uv"></span>人次
    </span>
  </div>
</div>
<div class="footer-col">
  <div>友情链接</div>
  
  
  
  
    
        <div><a href="https://malagis.com" target="_blank">麻辣GIS</a></div>
    
  
    
        <div><a href="https://www.giserdqy.com" target="_blank">GIS开发者</a></div>
    
  
    
        <div><a href="https://earth.nullschool.net/zh-cn/" target="_blank">earth.nullschool</a></div>
    
  
    
        <div><a href="https://www.gisclouder.com/" target="_blank">码上GIS实现的热力图</a></div>
    
  
    
        <div><a href="http://www.cnblogs.com/naaoveGIS/" target="_blank">李晓辉的博客园</a></div>
    
  
    
        
          <div><a href="/links">更多</a></div>
          
        
    
  
    
        
    
  
    
        
    
  
    
        
    
  
  <div class="chain-msg">**注意：以上网站都没给钱**</div>
</div>
<div class="footer-col">
  <div>精彩推荐</div>
  
    <div><a href="/study">励志</a></div>
  
    <div><a href="/anime">动漫</a></div>
  
    <div><a href="/movie">电影</a></div>
  
    <div><a href="/tv">电视</a></div>
  
    <div><a href="/book">书籍</a></div>
  
</div>
<div class="footer-col">
  <div>开源项目</div>
  
    <div><a href="/"></a></div>
  
</div>
          
        </div>
      </div>
    </footer>

    


<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>

    
        
            
            
            <script type="text/javascript" src="/lib/layui/layui.js"></script>
        
    
        
    

    
        
            
            
                
            
            <script type="text/javascript" src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
        
    

    
        
            
            
            <script type="text/javascript" src="/lib/jquery.actual.min.js"></script>
        
    


    


  <script type="text/javascript" src="/js/src/utils.js?v="></script>



    
      <script type="text/javascript" src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
<script type="text/javascript">
  var client = algoliasearch('DM9LMZOGZE', '1c2739694b8acb4c4edab8ccb098d166');
  var index = client.initIndex('bibichuan');
  $(document).ready(function(){
    var $search=$(".header-wrap");
    var $searchbtn= $search.find(".find");
    var $ipt=$search.find(".search-ipt");
    var $resultClear=$search.find(".clear");
    var $result=$search.find(".result");
    // 加入layui
    layui.use('layer', function(){
      var layer = layui.layer;
      // 搜索按钮点击
      $searchbtn.on("click",function(){
        var text=$ipt.val();
        var $this=$(this);
        var $resultContent=$result.find(".result-content");
        if(text){
          var loadDialog=layer.load();
          if(!$this.hasClass("disabled")){
            $this.addClass("disabled");
            index.search(text, (err, { hits } = {}) => {
              layer.close(loadDialog); 

              $this.removeClass("disabled");
              var resultHtml="";
              // 命中
              if(hits.length>0){
                var count=hits.length;
                for(var i=0;i<count;i++){
                  var h=hits[i];
                  //根据返回值中_highlightResult来判断显示的内容。
                  var content=h.contentStripTruncate;
                  var _highlight=h._highlightResult;

                  var resultC="";
                  var hitType=""; // 命中的类型
                  //标题命中
                  if(_highlight.title&&!resultC){  
                    if(_highlight.title.matchLevel&&_highlight.title.matchLevel!='none'){
                      resultC=_highlight.title.value;
                      hitType="title";
                    }
                  }
                  //分类命中
                  if(_highlight.categories&&!resultC){ 
                    var arr=_highlight.categories;
                    if(arr instanceof Array){
                      var countTemp=arr.length;
                      for(var j=0;j<countTemp;j++){
                        var temp=arr[j];
                        if(temp.matchLevel&&temp.matchLevel!='none'){
                          resultC=temp.value;
                          hitType="categories";
                        }
                      }
                    }else{
                      if(arr.matchLevel&&arr.matchLevel!='none'){
                        resultC=arr.value;
                        hitType="categories";
                      }
                    }
                  }

                  //标签命中
                  if(_highlight.tags&&!resultC){ 
                    var arr=_highlight.tags;
                    if(arr instanceof Array){
                      var countTemp=arr.length;
                      for(var j=0;j<countTemp;j++){
                        var temp=arr[j];
                        if(temp.matchLevel&&temp.matchLevel!='none'){
                          resultC=temp.value;
                          hitType="tags";
                        }
                      }
                    }else{
                      if(arr.matchLevel&&arr.matchLevel!='none'){
                        resultC=arr.value;
                        hitType="tags";
                      }
                    }
                  }

                  // 内容命中
                  if(!resultC){ 
                    resultC=_highlight.contentStripTruncate.value;
                    hitType="contentStripTruncate";
                  }

                  //如果内容过长，则截断
                  if(resultC.length>50){
                    var index=resultC.indexOf('<em>');
                    var blockIndex=10;
                    if(index>=blockIndex){
                      index=index-blockIndex;
                    }else{
                      index=0;
                    }
                    resultC="..."+resultC.substring(index,index+20+blockIndex)+"...";
                  }
                  switch(hitType){
                    case "title":
                      resultC="标题："+resultC;
                      break;
                    case "categories":
                      resultC="分类："+resultC;
                      resultC+=" ("+h.contentStripTruncate.substring(0,40)+"...)";
                      break;
                    case "tags":
                      resultC="标签："+resultC;
                      resultC+=" ("+h.contentStripTruncate.substring(0,40)+"...)";
                      break;
                    case "contentStripTruncate":
                      resultC="内容："+resultC;
                      break;
                  }

                  resultHtml+='<li class="result-item" title="'+content+'"><a href="'+h.permalink+'">'+resultC+'</a></li>';
                }
                $(resultHtml).appendTo($resultContent.empty());
                $result.show();
                $resultClear.show();
              }else{
                var resultHtml='<li class="result-item" title="未找到相关内容"><a>未找到相关内容</a></li>';
                $(resultHtml).appendTo($resultContent.empty());
                $result.show();
                $resultClear.show();
              }
            });
          }
        }else{
          layer.msg("请输入搜索内容");
        }
      });
      // 删除输入内容
      $resultClear.on("click",function(){
        $result.hide();
        $resultClear.hide();
        //清空输入内容
        $ipt.val("");
      });
      // 监听确定事件
      $ipt.keydown(function(e){
        if(e.keyCode==13){
          $searchbtn.click();
        }
      });
    });              
  
  });
</script>
    

    
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.js"></script>
<script src="/js/src/post/post.js">></script>

  

  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = 'https://bibichuan.github.io/posts/48b15d76.html';
      this.page.identifier = 'posts/48b15d76.html';
      this.page.title = 'Hexo自定义主题（三）';
      };
    // 加载评论内容
    function loadComments () {
      var d = document, s = d.createElement('script');
      s.src = 'https://https-bibichuan-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);

      // 隐藏相关文章
      s.onload = function () {
        var relatedCommon=$('#comments #disqus_recommendations');
        if(relatedCommon){
          relatedCommon.hide();
        }

      }
    }
    function scrollFunction(){
      // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = $('#comments').offset().top - $(window).height();
          var scrollTop = $(window).scrollTop();

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            $(window).off('scroll',scrollFunction);
            loadComments();
          }
    }
    $(function () {
      if($("#comments").length<=0){
        return;
      }
      var offsetTop = $('#comments').offset().top - $(window).height();
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        loadComments();
      } else {
        $(window).on('scroll', scrollFunction);
      }
    });
  </script>



<script src="/lib/share/iShare.js"></script>
<script type="text/javascript">
var iSharel=(new iShare({container:'.iShare-content',config:{
		title: '这里有精彩的内容，你确定不过来看看吗？链接标题：Hexo自定义主题（三） 链接地址:https://bibichuan.github.io/posts/48b15d76.html  |(复制此地址在浏览器中打开)——bibichaun出品。',
		description: 'Hexo自定义主题（三）',
		url: 'https://bibichuan.github.io/posts/48b15d76.html',
		isAbroad: false,
		isTitle: true,
		initialized: true,
		WXoptions:{
			evenType: 'click',
			isTitleVisibility: true,
			title: 'Hexo自定义主题（三）',
			isTipVisibility: true,
			tip: 'Hexo自定义主题（三）',
			qrcodeW: '120',
			qrcodeH: '120',
			qrcodeFgc: '#4a148c',
      bgcolor: '#2BAD13'
		}
	}}));
</script>


</body>
</html>