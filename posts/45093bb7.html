<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>软件研究之Mars3d</title>
    <!-- 页面描述 -->
<meta name="description" content=""/>
<!-- 页面关键词 -->
<meta name="keywords" content=""/>
<!-- 网页作者 -->
<meta name="author" content="bibichuan, ibibichuan@gmail.com"/>
<!-- 搜索引擎抓取 -->
<meta name="robots" content="index,follow"/>

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>

<!--禁止百度转码-->
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<!--启用WebApp全屏模式-->
<meta name="apple-mobile-web-app-capable" content="yes" />
<!--禁止数字自动识别为电话号码-->
<meta name="format-detection" content="telephone=no" />
<!--忽略识别邮箱-->
<meta name="format-detection" content="email=no" />
<!--360强制谷歌内核-->
<meta name="renderer" content="webkit"> 

<link rel="icon" href="/images/favicon.ico">

<link rel="stylesheet" href="//at.alicdn.com/t/font_1022896_nclaqhxyt.css">

<link href="/css/main.css" rel="stylesheet" type="text/css" />

<!-- 谷歌广告 -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8382618401389723"></script>


<script type="text/javascript" id="hexo.configurations">
  var BTheme = window.BTheme ||{};
  var CONFIG = {
    root: '/'
  };
</script>

<!--百度统计-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ee4ff785c4c68fa9a0ea17241e0574ea";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!--谷歌统计-->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G4HPTST8XX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-G4HPTST8XX');
</script>

    
    
        
    
        
            
            
            <link href="/lib/layui/css/layui.css" rel="stylesheet" type="text/css" />
        
    

    
        
    

    
        
    


    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.css" />
<link rel="stylesheet" type="text/css" href="/lib/share/style/css/ishare.css">

<meta name="generator" content="Hexo 5.4.2"></head>
<body class="main">

    <header id="header" class="header layui-fluid">
        <div class="header-inner layui-row"><div class="header-wrap">
    <div class="logo_wrap">
        <a href="/"><img src="/images/logo.png"></a>
    </div>
    <div class='search-warp'>
  <div class="search">
    <input class="search-ipt" placeholder="请输入搜索内容"/>
    <div class="search-btn clear"><i class="iconfont icon-guanbi"></i></div>
    <div class="search-btn find"><i class="iconfont icon-sousuo"></i></div>
  </div>
  <div class="result">
    <ul class="result-content"></ul>
  </div>
</div>
    <div class="icon-menu"><i class="iconfont icon-m_menu"></i></div>
    <nav class="site-nav">
        <ul class="menu layui-nav">
            
            
            <li class="menu-item layui-nav-item">
                <a href="/" rel="section">
                    <i class="iconfont icon-home"></i>首页<i class="iconfont icon-header-mobile icon-right"></i>
                </a>
            </li>
            
            

            
            

            
            
                
                
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/%E6%9D%82%E6%96%87/">
                                    杂文
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/Python/">
                                    Python
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/Gis/">
                                    Gis
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/Asp/">
                                    Asp
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                        
                        
                            
                            <li class="menu-item layui-nav-item">
                                <a href="/categories/%E8%BD%AF%E4%BB%B6/">
                                    软件
                                    <i class="iconfont icon-header-mobile icon-right"></i>
                                </a>
                            </li>
                        
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                
                <li class="more menu-item layui-nav-item">
                    
                    <a href="javascript:;" class="menu-more">
                        更多分类
                        <i class="iconfont icon-header-mobile icon-sidemenu"></i>
                    </a>
                    
                    <dl class="layui-nav-child">
                        
                            
                            
                        
                            
                            
                        
                            
                            
                        
                            
                            
                        
                            
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/Java/">
                                            Java
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E5%89%8D%E7%AB%AF/">
                                            前端
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/Javascript/">
                                            Javascript
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                            数据库
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
                                            操作系统
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/Nodejs/">
                                            Nodejs
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">
                                            大数据
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1/">
                                            后台服务
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E9%9A%8F%E7%AC%94/">
                                            随笔
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">
                                            机器学习
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                            
                            
                                
                                
                                    
                                    <dd class="nav-child">
                                        <a href="/categories/%E5%85%B6%E4%BB%96/">
                                            其他
                                            <i class="iconfont icon-header-mobile icon-right"></i>
                                        </a>
                                    </dd>
                                
                            
                        
                    </dl>
                </li>
            
        </ul>
    </nav>
</div></div>
    </header>
    
    <main class="main-content layui-fluid" id="main-content">
      <div class="main-inner">
        
  <div class="layui-row layui-col-space15">
    <div class="layui-col-xs12 layui-col-sm10 layui-col-sm-offset1 layui-col-md6 layui-col-md-offset2 layui-col-lg6 layui-col-lg-offset2">
        <div class="container post_wrap">
          <div class="post">
            <div class="article">
              <h1 class="title">软件研究之Mars3d</h1>
              <div class="author">
                <span class="tag">标签：
                  

                  
                    无
                  
                </span>
                <span class="tag">分类：
                  

                  
                    未分类
                  
                </span>
                <span class='tag'>
                  创建时间：2023-01-16 01:29:00
                </span>
                <span class='tag'>
                  更新时间：2025-04-28 14:37:41
                </span>
              </div>
              <div class="content">
                <html><head></head><body><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>准备用Cesium进行三维开发。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>(1) 掩膜无法覆盖全<br>我使用阿里云的行政区县数据生成掩膜，增加了一个 mask 属性</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载行政区划</span></span><br><span class="line"><span class="keyword">const</span> geoJsonLayer = <span class="keyword">new</span> mars3d.<span class="property">layer</span>.<span class="title class_">GeoJsonLayer</span>({</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"行政区划"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">"https://geo.datav.aliyun.com/areas_v3/bound/330110.json"</span>,</span><br><span class="line">    <span class="attr">flyTo</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 可以通过配置symbol参数来指定渲染的矢量数据类型和样式。</span></span><br><span class="line">    <span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">symbol</span>: {</span><br><span class="line">        <span class="attr">type</span>: <span class="string">"polygon"</span>,</span><br><span class="line">        <span class="attr">styleOptions</span>: {</span><br><span class="line">            <span class="attr">color</span>: <span class="string">"#000000"</span>,</span><br><span class="line">            <span class="attr">opacity</span>: <span class="number">0.5</span>,</span><br><span class="line">            <span class="attr">width</span>: <span class="number">2</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">})</span><br><span class="line">map.<span class="title function_">addLayer</span>(geoJsonLayer)</span><br></pre></td></tr></tbody></table></figure>

<p>结果显示错误，也就是在掩膜之外，还有一个角没有被淹没覆盖。</p>
<img src="/images/loadimg.png" data-original="/posts/45093bb7/mars3d_1.jpeg" lay-src="/posts/45093bb7/mars3d_1.jpeg" class="" title="Mars3D研究">

<p>【解决方法】<br>经过一个星期的等待，结果官方的人给了回复，说是要在设置样式的时候，要增加一个贴地属性 clampToGround 。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载行政区划</span></span><br><span class="line"><span class="keyword">const</span> geoJsonLayer = <span class="keyword">new</span> mars3d.<span class="property">layer</span>.<span class="title class_">GeoJsonLayer</span>({</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"行政区划"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">"https://geo.datav.aliyun.com/areas_v3/bound/330110.json"</span>,</span><br><span class="line">    <span class="attr">flyTo</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 可以通过配置symbol参数来指定渲染的矢量数据类型和样式。</span></span><br><span class="line">    <span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">symbol</span>: {</span><br><span class="line">        <span class="attr">type</span>: <span class="string">"polygon"</span>,</span><br><span class="line">        <span class="attr">styleOptions</span>: {</span><br><span class="line">            <span class="attr">color</span>: <span class="string">"#000000"</span>,</span><br><span class="line">            <span class="attr">opacity</span>: <span class="number">0.5</span>,</span><br><span class="line">            <span class="attr">width</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="comment">// 增加贴地属性，解决掩膜问题</span></span><br><span class="line">            <span class="attr">clampToGround</span>: <span class="literal">true</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">})</span><br><span class="line">map.<span class="title function_">addLayer</span>(geoJsonLayer)</span><br></pre></td></tr></tbody></table></figure>

<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6963557baa0b">Mars3D之关于贴地问题</a> style加个clampToGround:true属性</div>
<h2 id="2-坐标系"><a href="#2-坐标系" class="headerlink" title="2.坐标系"></a>2.坐标系</h2><p>Mars3D默认的坐标系是4326坐标系，就算是使用的高德的暗色底图，也是进行了转换，转成了4326坐标系，所以鼠标在地图上滑动，底下显示的也是4326的经纬度。比如 合景叠彩园 这个地址，坐标如下：</p>
<ul>
<li>天地图浙江：[120.024,30.276]</li>
<li>Mars3D：[120.023983,30.276061]</li>
<li>高德坐标拾取器：[120.028748,30.273686]</li>
<li>百度坐标拾取器：[120.035217,30.279733]</li>
</ul>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">"basemaps"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"id"</span><span class="punctuation">:</span> <span class="number">2017</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"暗色底图"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"gaode"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="string">"img/basemaps/blackMarble.png"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"layer"</span><span class="punctuation">:</span> <span class="string">"vec"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"invertColor"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"filterColor"</span><span class="punctuation">:</span> <span class="string">"#4e70a6"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"brightness"</span><span class="punctuation">:</span> <span class="number">0.6</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"contrast"</span><span class="punctuation">:</span> <span class="number">1.8</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"gamma"</span><span class="punctuation">:</span> <span class="number">0.3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"hue"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"saturation"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"show"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></tbody></table></figure>


<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="http://datav.aliyun.com/portal/school/atlas/area_selector">阿里云地图选择器</a> 这里使用的是高德的地图，坐标系就是GCJ02<br>2.<a target="_blank" rel="noopener" href="http://api.map.baidu.com/lbsapi/getpoint/index.html">百度坐标拾取器</a> 百度坐标<br>3.<a target="_blank" rel="noopener" href="https://www.cnblogs.com/miaSlady/p/13277831.html">拾取坐标系统（高德、百度、谷歌、腾讯）</a><br>4.<a target="_blank" rel="noopener" href="https://github.com/hujiulong/gcoord"> hujiulong /gcoord </a> 坐标转换工具，可以转换 WGS84、GCJ02、BD09等坐标系，暂时不支持4490坐标系<br>5.<a target="_blank" rel="noopener" href="https://dx3377.com/map/longlat.php">百度地图,高德地图和wgs84坐标系转换、度分秒十进制坐标格式互转</a> 在线坐标转换<br>6.<a target="_blank" rel="noopener" href="https://zhejiang.tianditu.gov.cn/map">天地图浙江</a> 可以鼠标滑动确定大致的经纬度<br>7.<a target="_blank" rel="noopener" href="https://github.com/hujiulong/gcoord"> hujiulong / gcoord </a> 这是在代码仓库中的一个。</div>
<h2 id="3-不同级别显示不同的样式"><a href="#3-不同级别显示不同的样式" class="headerlink" title="3.不同级别显示不同的样式"></a>3.不同级别显示不同的样式</h2><p>需求就是不同的显示级别，但是我找来找去，在 GeoJsonLayer 找到关于不同级别配置不同样式的例子，唯一的 symbol 属性配置函数，但是每次视图发生变化的时候，并不会重新调用这个函数。</p>
<p>后来想到的一种解题思路，就是 监听地图相机的高度，然后转换为层级，当达到了相应的高度的时候，对图层进行删除，重新添加新的样式的图层。</p>
<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="http://mars3d.cn/apidoc.html#GeoJsonLayer">GeoJsonLayer</a><br>2.<a target="_blank" rel="noopener" href="https://blog.csdn.net/u010358183/article/details/121610901">Cesium 事件详解（鼠标事件、相机事件、键盘事件、场景触发事件）</a> 屏幕空间事件处理程序、屏幕空间相机控制器、场景触发事件、Cesium API 中的场景触发事件</div>
<h2 id="4-GeoJsonLayer图片类型特别的卡"><a href="#4-GeoJsonLayer图片类型特别的卡" class="headerlink" title="4.GeoJsonLayer图片类型特别的卡"></a>4.GeoJsonLayer图片类型特别的卡</h2><p>渲染这个GeoJsonLayer图层的时候，特别的慢。我主要就是加载图层，然后有一个控制开关，就是过滤属性，哪些要素不用显示，哪些要显示。我的做法是遍历数据，筛选需要的feature，然后把原先的图层用 map.removeLayer 删掉，然后用新的数据构建新的图层。代码截图如下：</p>
<img src="/images/loadimg.png" data-original="/posts/45093bb7/mars3d_2.jpeg" lay-src="/posts/45093bb7/mars3d_2.jpeg" class="" title="Mars3D研究">

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清空已有图层</span></span><br><span class="line"><span class="title function_">clearMap</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建完整的geojson</span></span><br><span class="line"><span class="keyword">const</span> geojson = { </span><br><span class="line">    <span class="attr">type</span>: <span class="string">"FeatureCollection"</span>,  </span><br><span class="line">    <span class="attr">features</span>: showFeatures</span><br><span class="line">}</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(geojson)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重新绘制图层</span></span><br><span class="line">rfdwLayer = <span class="keyword">new</span> mars3d.<span class="property">layer</span>.<span class="title class_">GeoJsonLayer</span>({</span><br><span class="line"><span class="attr">name</span>: <span class="string">"点位"</span>,</span><br><span class="line"><span class="attr">data</span>: geojson,</span><br><span class="line"><span class="attr">symbol</span>: <span class="function">(<span class="params">attr, style, feature</span>) =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="attr">image</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_BASE_URL</span> + <span class="string">"img/renfang.png"</span>,</span><br><span class="line">    <span class="attr">scale</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">scaleByDistance</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">scaleByDistance_far</span>: <span class="number">20000</span>,</span><br><span class="line">    <span class="attr">scaleByDistance_farValue</span>: <span class="number">0.5</span>,</span><br><span class="line">    <span class="attr">scaleByDistance_near</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">scaleByDistance_nearValue</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">verticalOrigin</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">horizontalOrigin</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// clampToGround: true,</span></span><br><span class="line">    <span class="attr">label</span>: {</span><br><span class="line">      <span class="attr">text</span>: <span class="string">"{JZMC}"</span>,</span><br><span class="line">      <span class="attr">font_size</span>: <span class="number">18</span>,</span><br><span class="line">      <span class="attr">color</span>: <span class="string">"#ffffff"</span>,</span><br><span class="line">      <span class="attr">verticalOrigin</span>: mars3dCesium.<span class="property">VerticalOrigin</span>.<span class="property">CENTER</span>,</span><br><span class="line">      <span class="attr">outline</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">outlineColor</span>: <span class="string">"#000000"</span>,</span><br><span class="line">      <span class="attr">pixelOffsetY</span>: -<span class="number">35</span>,</span><br><span class="line">      <span class="attr">scaleByDistance</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">scaleByDistance_far</span>: <span class="number">80000</span>,</span><br><span class="line">      <span class="attr">scaleByDistance_farValue</span>: <span class="number">0.5</span>,</span><br><span class="line">      <span class="attr">scaleByDistance_near</span>: <span class="number">1000</span>,</span><br><span class="line">      <span class="attr">scaleByDistance_nearValue</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">distanceDisplayCondition</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">distanceDisplayCondition_far</span>: <span class="number">5000</span>,</span><br><span class="line">      <span class="attr">distanceDisplayCondition_near</span>: <span class="number">0</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">})</span><br><span class="line">mainmap.<span class="title function_">addLayer</span>(rfdwLayer)</span><br></pre></td></tr></tbody></table></figure>

<p>样式如果这么写的话，每次属性切换的时候，就特别的卡。没有报错，只是浏览器会显示警告。每次切换属性的时候，这个警告数量跳的很慢，警告跳完了之后，图层才会加载完成。在官方示例 <a target="_blank" rel="noopener" href="http://mars3d.cn/editor-vue.html?id=layer-graphic/geojson/basis">GeoJson矢量图层</a> 这个示例中的体育设施点，也会存在这个问题，就是每次点击体育设施点，都会有停顿的显示。这里之所以显示的快，是因为体育设施点只有91个，还算能接受。如果体育设施点超过400个，我自己的项目中就超过了400个，那么每一次清空图层之后重新创建的时间就特别的长。</p>
<img src="/images/loadimg.png" data-original="/posts/45093bb7/mars3d_3.jpeg" lay-src="/posts/45093bb7/mars3d_3.jpeg" class="" title="Mars3D研究">

<p>【尝试】<br>(1) 反馈到官方群里，给我建了一个issue <a target="_blank" rel="noopener" href="https://gitee.com/marsgis/mars3d/issues/I6D0G3?from=project-issue">GeoServer矢量服务查询(OGC WFS)示例代码里面的点，有这个image属性，是为什么? </a>。<br>(2) 后来我单独的开了一个issue,<a target="_blank" rel="noopener" href="https://gitee.com/marsgis/mars3d/issues/I6D649?from=project-issue">GeoJsonLayer设置image样式时特别的卡</a> 这是我的问题的具体描述，为了保证官方能第一时间准确的定位问题，我花了很多的时间处理这个东西。<br>(3) 我还尝试使用<a target="_blank" rel="noopener" href="http://mars3d.cn/editor-vue.html?id=graphic/primitive/billboard-list">示例</a></p>
<p>【解决方案】<br>官方给我的解决方案：“通过使用show来显示和隐藏处理。如果属性比较多，就要，就要创建多个图层，或者发布为矢量服务，如wfs服务。” 没有其他的办法了，这个回答显然让我非常的不满意。</p>
<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="http://mars3d.cn/editor-vue.html?id=layer-graphic/wfs/lod">矢量数据Lod加载</a><br>3.<a target="_blank" rel="noopener" href="http://mars3d.cn/editor-vue.html?id=graphic/primitive/billboard-list">矢量数据-Primitive基础对象-图标点+文字</a></div>
<h2 id="5-GeoJsonLayer没有image属性"><a href="#5-GeoJsonLayer没有image属性" class="headerlink" title="5.GeoJsonLayer没有image属性"></a>5.GeoJsonLayer没有image属性</h2><p>在写geojson用图片渲染的时候，发现<a target="_blank" rel="noopener" href="http://mars3d.cn/apidoc.html#GeoJsonLayer">GeoJsonLayer</a> 代码里面的 type 如果是 pointEntity ，没有这个image属性，但是<a target="_blank" rel="noopener" href="http://mars3d.cn/editor-vue.html?id=layer-graphic/geojson/basis">示例</a>中却出现了。官方回复我，说是PointEntity有一个属性叫 billboard ，可以设置图片的样式。</p>
<p>经过我的查找，这个 GeoJsonLayer 图层的 symbol 属性 styleOptions，对应的是每种不同类型数据都有不同的样式，具体见各GraphicType矢量数据的style参数。但是恰好这个PointEntity的style中没有这个image参数。这个billboard就是额外的属性了，这是文档的错误还是说可以直接这么使用呢？</p>
<h2 id="6-Cesium-is-not-defined"><a href="#6-Cesium-is-not-defined" class="headerlink" title="6.Cesium is not defined"></a>6.Cesium is not defined</h2><p>打包之后，运行的时候，出现了这个问题，但是开发的时候没有问题。</p>
<p>【解决方法】<br>后来在检查代码的时候，我发现了在我的一个文件中有 @ts-nocheck 这个标签，这个文件里面引用了Cesium变量，但是没有定义。开发的时候没有报错，但是打包之后就出现了错误。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @ts-nocheck</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> mars3d <span class="keyword">from</span> <span class="string">"mars3d"</span></span><br><span class="line"><span class="comment">// 增加下面这个东西</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Cesium</span> <span class="keyword">from</span> <span class="string">"mars3d-cesium"</span></span><br></pre></td></tr></tbody></table></figure>

<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_53584457/article/details/125331355">[mars3d] 创建vite项目，集成mars3d</a><br>2.<a target="_blank" rel="noopener" href="https://blog.csdn.net/wwf1225/article/details/114535095">cesium is not defined</a> 这里是eslintConfig导致Cesium未定义</div>
<h2 id="7-原生Cesium无法加载模型"><a href="#7-原生Cesium无法加载模型" class="headerlink" title="7.原生Cesium无法加载模型"></a>7.原生Cesium无法加载模型</h2><p>我在Mars3d中使用Cesium方式加载模型，我使用的是 import * as Cesium from “mars3d-cesium” 方式定义的Cesium，但是总是出不来。后来问了群里的人，说要使用 const Cesium = mars3d.Cesium 代替 import * as Cesium from “mars3d-cesium” 才可以。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这句话很重要，不能用 import * as Cesium from "mars3d-cesium"，否则模型出不来</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Cesium</span> = mars3d.<span class="property">Cesium</span>; </span><br><span class="line"><span class="keyword">let</span> viewer = map.<span class="property">viewer</span>;</span><br><span class="line"><span class="keyword">let</span> scene = viewer.<span class="property">scene</span>;</span><br><span class="line"><span class="keyword">var</span> url=<span class="string">"//data.mars3d.cn/3dtiles/max-shihua/tileset.json"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载3d模型</span></span><br><span class="line"><span class="keyword">const</span> tileset = scene.<span class="property">primitives</span>.<span class="title function_">add</span>(</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">Cesium3DTileset</span>({</span><br><span class="line">    <span class="attr">url</span>: url,</span><br><span class="line">  })</span><br><span class="line">);</span><br><span class="line">tileset.<span class="property">readyPromise</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">tileset:any</span>) {</span><br><span class="line">    <span class="comment">// tileset的边界球</span></span><br><span class="line">    <span class="keyword">let</span> boundingSphere = tileset.<span class="property">boundingSphere</span>;</span><br><span class="line">    <span class="comment">// 跳到边界球范围</span></span><br><span class="line">    viewer.<span class="property">camera</span>.<span class="title function_">flyToBoundingSphere</span>(boundingSphere);</span><br><span class="line">    <span class="comment">// 绑定相机所在的位置：必须设置，否则左键移动变成单点定位</span></span><br><span class="line">    viewer.<span class="property">camera</span>.<span class="title function_">lookAtTransform</span>(<span class="title class_">Cesium</span>.<span class="property">Matrix4</span>.<span class="property">IDENTITY</span>);</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error:any</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  });</span><br></pre></td></tr></tbody></table></figure>

<h2 id="8-mars3d和mars3d-cesium独立打包"><a href="#8-mars3d和mars3d-cesium独立打包" class="headerlink" title="8.mars3d和mars3d-cesium独立打包"></a>8.mars3d和mars3d-cesium独立打包</h2><p>在我使用 Mars3d提供的最简<a target="_blank" rel="noopener" href="https://github.com/marsgis/mars3d-vue-template">模版</a>，进行打包的时候，虽然mars3d-cesium被独立出来了，但是代码还是被打包进了index.js文件中，导致了index.js又十多M的大小。</p>
<img src="/images/loadimg.png" data-original="/posts/45093bb7/mars3d_4.jpg" lay-src="/posts/45093bb7/mars3d_4.jpg" class="" title="Mars3D">

<p>版本是v3.5.0,时间是2023年04月03日。后来官方的给我开了一个<a target="_blank" rel="noopener" href="https://gitee.com/marsgis/mars3d/issues/I6SFKO?from=project-issue">issue</a>，进行问题的解决。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"mars3d"</span>: <span class="string">"~3.5.0"</span>,</span><br><span class="line"><span class="string">"mars3d-cesium"</span>: <span class="string">"^1.103.2"</span>,</span><br><span class="line"><span class="string">"vue"</span>: <span class="string">"^3.2.27"</span></span><br></pre></td></tr></tbody></table></figure>

<p>【解决方案】<br>官方给了一个方案，就是代码层面没有什么可以优化的了。我自己研究了下，重新配置了vite的打包选项</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build</span>: {</span><br><span class="line">  <span class="attr">rollupOptions</span>: {</span><br><span class="line">    <span class="attr">output</span>: {</span><br><span class="line">      <span class="attr">manualChunks</span>: {</span><br><span class="line">        <span class="attr">mars3d</span>: [<span class="string">'mars3d'</span>],</span><br><span class="line">        <span class="string">'mars3d-cesium'</span>: [<span class="string">"mars3d-cesium"</span>]</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">target</span>: <span class="string">'esnext'</span>, </span><br><span class="line">    <span class="attr">minify</span>: <span class="string">'esbuild'</span> <span class="comment">// 混淆器，terser构建后文件体积更小</span></span><br><span class="line">  },</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>打包后的信息如下：</p>
<img src="/images/loadimg.png" data-original="/posts/45093bb7/mars3d_5.jpg" lay-src="/posts/45093bb7/mars3d_5.jpg" class="" title="Mars3D">

<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="https://juejin.cn/post/7166154139666219039">Mars3d试水–vite</a><br>2.<a target="_blank" rel="noopener" href="https://gitee.com/marsgis/mars3d/issues/I6LR1T">这个mars3d，在webpack和vite打包能否按需使用? </a></div>
<h2 id="9-鼠标点击高亮"><a href="#9-鼠标点击高亮" class="headerlink" title="9.鼠标点击高亮"></a>9.鼠标点击高亮</h2><div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/453659946">Mars3D高亮效果怎么实现</a> 这篇文章写了如何进行配置</div>
<h2 id="10-vitePluginMars3d-is-not-a-function"><a href="#10-vitePluginMars3d-is-not-a-function" class="headerlink" title="10.vitePluginMars3d is not a function"></a>10.vitePluginMars3d is not a function</h2><p>这个问题出现在使用 vitePluginMars3d 这个插件之后出现的问题。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { vitePluginMars3d } <span class="keyword">from</span> <span class="string">"vite-plugin-mars3d"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vite plugins 配置</span></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="title function_">vue</span>(),</span><br><span class="line">  <span class="title function_">vitePluginMars3d</span>(),</span><br><span class="line">],</span><br></pre></td></tr></tbody></table></figure>

<p>这个在早期的版本中奏效，但是最新版本的 vite-plugin-mars3d 插件导出的函数有所变化。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { mars3dPlugin } <span class="keyword">from</span> <span class="string">'vite-plugin-mars3d'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vite plugins 配置</span></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="title function_">vue</span>(),</span><br><span class="line">  <span class="title function_">mars3dPlugin</span>(),</span><br><span class="line">],</span><br></pre></td></tr></tbody></table></figure>

<h2 id="11-加载的Geojson总是先显示然后消失"><a href="#11-加载的Geojson总是先显示然后消失" class="headerlink" title="11.加载的Geojson总是先显示然后消失"></a>11.加载的Geojson总是先显示然后消失</h2><p>就是我用了一个GeojsonLayer图层，去加载了一系列的点，这些点图标总是先加载一遍，然后消失，等我拖动地图的时候，没一会这些点图标就显示出来了。</p>
<p>【尝试方案】<br>这个解决方案，就是这些个点的高度不够，需要设置一个高度。</p>
<p>【解决方案】<br>这个问题主要是出在这个 clampToGround: true, // 是否贴地 属性上，计算贴地之后，会导致图标出现问题。有人说：“你这是因为地形加载慢吧，先没地形，加载了贴地图标，然后地形才加载出来，一瞬间把图标淹没了，再然后图标重新贴地就又出来了。” 可是我没有加载地形啊。</p>
<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="http://mars3d.cn/editor-vue.html?id=layer-graphic/fun/clampToGround">clampToGround</a></div>
<h2 id="12-mars3d-heatmap插件"><a href="#12-mars3d-heatmap插件" class="headerlink" title="12.mars3d-heatmap插件"></a>12.mars3d-heatmap插件</h2><p>我安装了mars3d-heatmap 插件，为什么直接引入 import ‘mars3d-heatmap’，会报错：Could not resolve “@mars3d/heatmap.js” … ‘undefined’ ? factory(exports, (window.mars3d || require(‘mars3d’)), (window.h337 || require(‘@mars3d/heatmap.js’))) :</p>
<img src="/images/loadimg.png" data-original="/posts/45093bb7/mars3d_6.png" lay-src="/posts/45093bb7/mars3d_6.png" class="" title="Mars3d">

<p>版本也是对的</p>
<img src="/images/loadimg.png" data-original="/posts/45093bb7/mars3d_5.png" lay-src="/posts/45093bb7/mars3d_5.png" class="" title="Mars3d">


<p>后来不知道怎么搞的，又好了，但是提示的内容又不正确了，提示我 heatmap.js 没有引入，但是我已经安装引入了。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Cesium</span> <span class="keyword">from</span> <span class="string">'mars3d-cesium'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> mars3d <span class="keyword">from</span> <span class="string">'mars3d'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'heatmap.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'mars3d-heatmap'</span>;</span><br></pre></td></tr></tbody></table></figure>

<img src="/images/loadimg.png" data-original="/posts/45093bb7/mars3d_8.png" lay-src="/posts/45093bb7/mars3d_8.png" class="" title="Mars3d">

<p>插件的引入顺序</p>
<img src="/images/loadimg.png" data-original="/posts/45093bb7/mars3d_7.png" lay-src="/posts/45093bb7/mars3d_7.png" class="" title="Mars3d">

<p>【解决方案】<br>解决方案，也不是解决方案，只是我重新用了官方的示例模版，重新安装配置 heatmap，结果很顺利的继承了。而且我在mac电脑上，同样的代码，也是没有引入的问题的，那么问题到底出在哪里呢？</p>
<p>经过好几天的搁置，我最后分析了这个 mars3d-heatmap.js 这个插件的第一行，这里其实显示的就是需要一个 window.h337 全局变量，或者是 @mars3d/heatmap.js 这个插件，对应两种方式引入 heatmap.js 这个插件。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">module</span> !== <span class="string">'undefined'</span> ? <span class="title function_">factory</span>(<span class="built_in">exports</span>, (<span class="variable language_">window</span>.<span class="property">mars3d</span> || <span class="built_in">require</span>(<span class="string">'mars3d'</span>)), (<span class="variable language_">window</span>.<span class="property">h337</span> || <span class="built_in">require</span>(<span class="string">'@mars3d/heatmap.js'</span>))) :</span><br><span class="line"><span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.<span class="property">amd</span> ? <span class="title function_">define</span>([<span class="string">'exports'</span>, <span class="string">'mars3d'</span>, <span class="string">'@mars3d/heatmap.js'</span>], factory) :</span><br><span class="line">(<span class="variable language_">global</span> = <span class="keyword">typeof</span> globalThis !== <span class="string">'undefined'</span> ? globalThis : <span class="variable language_">global</span> || self, <span class="title function_">factory</span>(<span class="variable language_">global</span>[<span class="string">"mars3d-heatmap"</span>] = {}, <span class="variable language_">global</span>.<span class="property">mars3d</span>, <span class="variable language_">global</span>.<span class="property">h337</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>所以最后我将 插件进行了替换,换成 @mars3d/heatmap.js 就可以了。</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pnpm add heatmap</span><br><span class="line"><span class="comment"># 换成</span></span><br><span class="line">pnpm add mars3d-heatmap</span><br><span class="line">pnpm add @mars3d/heatmap.js</span><br></pre></td></tr></tbody></table></figure>

<p>正确的使用方式</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入mars3d插件（按需使用，需要先npm install mars3d-heatmap @mars3d/heatmap.js）</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'mars3d-heatmap'</span>;</span><br></pre></td></tr></tbody></table></figure>

<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="http://mars3d.cn/dev/guide/start/download.html">获取 Mars3D SDK类库</a> 这个离线获取，还是有点麻烦的。<br>2.<a target="_blank" rel="noopener" href="https://www.patrick-wied.at/static/heatmapjs/">heatmap.js</a><br>3.<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/76bdf7786dd5">个人笔记|vue+cesium用heatmap.js插件展示热力图0</a><br>4.<a target="_blank" rel="noopener" href="https://socket.dev/npm/package/mars3d-heatmap">mars3d-heatmap</a> 这里面也提到了@mars3d/heatmap.js， npm install mars3d-heatmap @mars3d/heatmap.js –save 但是我当时为什么没有看见呢？</div>
<h2 id="13-mars3d-echarts插件"><a href="#13-mars3d-echarts插件" class="headerlink" title="13.mars3d-echarts插件"></a>13.mars3d-echarts插件</h2><p>在我引入 mars3d-echarts插件的时候，又出现了问题:can’t access property “type”, seriesModel.coordinateSystem is undefined 。这个问题不知道怎么解决的，就解决了。后来又出现了新的问题，那就是在我按照官方的 <a target="_blank" rel="noopener" href="http://mars3d.cn/editor-vue.html?id=layer-other/echarts/lines-hanban">例子</a> 进行绘制的时候，基础模版和官方的例子都没有问题，有问题的是我自己的一模一样的代码里面，竟然所有的图标都是方块，而不是图形。</p>


<p>【解决方案】<br>问题就是少了图片的前缀。需要写上 “image://“  这样的路径，而不是 “image:”。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 错误的示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 城市点位图标</span></span><br><span class="line"><span class="keyword">const</span> symbolList = [</span><br><span class="line">  <span class="string">'image:'</span> + <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_PUBLIC_PATH</span> + <span class="string">'resource/map/symbol1.png'</span>,</span><br><span class="line">  <span class="string">'image:'</span> + <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_PUBLIC_PATH</span> + <span class="string">'resource/map/symbol2.png'</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 线上的动态运动点图标</span></span><br><span class="line"><span class="keyword">const</span> pointSymbol = [</span><br><span class="line">  <span class="string">'image:'</span> + <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_PUBLIC_PATH</span> + <span class="string">'resource/map/linePoint1.png'</span>,</span><br><span class="line">  <span class="string">'image:'</span> + <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_PUBLIC_PATH</span> + <span class="string">'resource/map/linePoint2.png'</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 正确的示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 城市点位图标</span></span><br><span class="line"><span class="keyword">const</span> symbolList = [</span><br><span class="line">  <span class="string">'image://'</span> + <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_PUBLIC_PATH</span> + <span class="string">'resource/map/symbol1.png'</span>,</span><br><span class="line">  <span class="string">'image://'</span> + <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_PUBLIC_PATH</span> + <span class="string">'resource/map/symbol2.png'</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 线上的动态运动点图标</span></span><br><span class="line"><span class="keyword">const</span> pointSymbol = [</span><br><span class="line">  <span class="string">'image://'</span> + <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_PUBLIC_PATH</span> + <span class="string">'resource/map/linePoint1.png'</span>,</span><br><span class="line">  <span class="string">'image://'</span> + <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_PUBLIC_PATH</span> + <span class="string">'resource/map/linePoint2.png'</span>,</span><br><span class="line">];</span><br></pre></td></tr></tbody></table></figure>

<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="https://blog.csdn.net/KanShiMeKan/article/details/126464620">vue3使用echarts5.3.3无法正常使用折线图</a><br>2.<a target="_blank" rel="noopener" href="https://www.cnblogs.com/suwanbin/p/15177380.html">echarts 中使用自定义图标无法显示</a> 这里给出了答案</div>
<h2 id="14-移动popup"><a href="#14-移动popup" class="headerlink" title="14.移动popup"></a>14.移动popup</h2><p>创建一个可以随着鼠标移动的弹出框，主要就是监听鼠标点击，弹起以及鼠标移动事件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示信息框</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">graphic</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showInfoWindow</span>(<span class="params">data</span>) {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  <span class="keyword">let</span> options = data.<span class="property">options</span>;</span><br><span class="line">  <span class="keyword">let</span> position = options.<span class="property">position</span>;</span><br><span class="line">  <span class="keyword">const</span> graphic = <span class="keyword">new</span> mars3d.<span class="property">graphic</span>.<span class="title class_">DivGraphic</span>({</span><br><span class="line">    <span class="attr">position</span>: position,</span><br><span class="line">    <span class="attr">style</span>: {</span><br><span class="line">      <span class="attr">html</span>: <span class="string">`&lt;div class="marspanel"&gt;</span></span><br><span class="line"><span class="string">        &lt;div class="marspanel-text"&gt;大湖名城,创新高地&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;`</span>,</span><br><span class="line">      <span class="attr">horizontalOrigin</span>: <span class="title class_">Cesium</span>.<span class="property">HorizontalOrigin</span>.<span class="property">LEFT</span>,</span><br><span class="line">      <span class="attr">verticalOrigin</span>: <span class="title class_">Cesium</span>.<span class="property">VerticalOrigin</span>.<span class="property">CENTER</span>,</span><br><span class="line">      <span class="attr">distanceDisplayCondition</span>: <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">DistanceDisplayCondition</span>(<span class="number">0</span>, <span class="number">400000</span>), <span class="comment">// 按视距距离显示</span></span><br><span class="line">      <span class="attr">clampToGround</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 高亮时的样式</span></span><br><span class="line">      <span class="attr">highlight</span>: {</span><br><span class="line">        <span class="comment">// type: mars3d.EventType.click,</span></span><br><span class="line">        <span class="attr">className</span>: <span class="string">'marspanel-highlight'</span>,</span><br><span class="line">      },</span><br><span class="line">    },</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 进行坐标转换</span></span><br><span class="line">  <span class="keyword">let</span> mainmap = <span class="variable language_">window</span>.<span class="property">mainmap</span>;</span><br><span class="line">  <span class="keyword">let</span> cartesian3 = mars3d.<span class="property">LngLatPoint</span>.<span class="title function_">toCartesian</span>(position);</span><br><span class="line">  <span class="keyword">var</span> windowPosition = <span class="title class_">Cesium</span>.<span class="property">SceneTransforms</span>.<span class="title function_">wgs84ToWindowCoordinates</span>(mainmap.<span class="property">scene</span>, cartesian3);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> mouseClick = <span class="literal">false</span>; <span class="comment">// 鼠标是否点击</span></span><br><span class="line">  <span class="keyword">let</span> startX = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> startY = <span class="number">0</span>;</span><br><span class="line">  graphic.<span class="title function_">on</span>(mars3d.<span class="property">EventType</span>.<span class="property">add</span>, <span class="keyword">function</span> (<span class="params">e</span>) {</span><br><span class="line">    <span class="keyword">const</span> container = e.<span class="property">graphic</span>.<span class="property">container</span>; <span class="comment">// popup对应的DOM</span></span><br><span class="line">    <span class="keyword">const</span> btnStatus1 = container.<span class="title function_">querySelector</span>(<span class="string">'.marspanel'</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(btnStatus1);</span><br><span class="line">    <span class="keyword">if</span> (btnStatus1) {</span><br><span class="line">      <span class="comment">// 启动面板移动</span></span><br><span class="line">      btnStatus1.<span class="title function_">addEventListener</span>(<span class="string">'mousedown'</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> {</span><br><span class="line">        e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">        startX = e.<span class="property">clientX</span>;</span><br><span class="line">        startY = e.<span class="property">clientY</span>;</span><br><span class="line">        mouseClick = <span class="literal">true</span>;</span><br><span class="line">      });</span><br><span class="line">      <span class="comment">// 停止面板移动</span></span><br><span class="line">      btnStatus1.<span class="title function_">addEventListener</span>(<span class="string">'mouseup'</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> {</span><br><span class="line">        e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">        mouseClick = <span class="literal">false</span>;</span><br><span class="line">      });</span><br><span class="line">    }</span><br><span class="line">  });</span><br><span class="line">  <span class="comment">// 监听鼠标移动，修改div的位置</span></span><br><span class="line">  mainmap.<span class="title function_">on</span>(mars3d.<span class="property">EventType</span>.<span class="property">mouseMove</span>, <span class="keyword">function</span> (<span class="params">e</span>) {</span><br><span class="line">    <span class="keyword">if</span> (mouseClick) {</span><br><span class="line">      <span class="keyword">let</span> endPostion = e.<span class="property">endPosition</span>;</span><br><span class="line">      <span class="keyword">let</span> endX = endPostion.<span class="property">x</span>;</span><br><span class="line">      <span class="keyword">let</span> endY = endPostion.<span class="property">y</span>;</span><br><span class="line">      <span class="keyword">let</span> offsetX = endX - startX;</span><br><span class="line">      <span class="keyword">let</span> offsetY = endY - startY;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 计算最终的坐标</span></span><br><span class="line">      <span class="keyword">let</span> moveX = windowPosition.<span class="property">x</span> + offsetX;</span><br><span class="line">      <span class="keyword">let</span> moveY = windowPosition.<span class="property">y</span> + offsetY;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(offsetX, offsetY, moveX, moveY);</span><br><span class="line">      <span class="comment">// 将屏幕坐标转为笛卡尔坐标</span></span><br><span class="line">      <span class="keyword">var</span> cartesian3 = mars3d.<span class="property">PointUtil</span>.<span class="title function_">getCurrentMousePosition</span>(mainmap.<span class="property">scene</span>, <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">Cartesian2</span>(moveX, moveY), <span class="literal">null</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(cartesian3);</span><br><span class="line">      <span class="keyword">let</span> lngLat = mars3d.<span class="property">LngLatPoint</span>.<span class="title function_">fromCartesian</span>(cartesian3);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(lngLat);</span><br><span class="line">      <span class="comment">// 设置最新的位置</span></span><br><span class="line">      graphic.<span class="property">position</span> = lngLat;</span><br><span class="line">    }</span><br><span class="line">  });</span><br><span class="line">  graphicLayer.<span class="title function_">addGraphic</span>(graphic);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这里其实涉及到了不同的坐标系之间的转换，屏幕坐标、笛卡尔坐标和经纬度坐标</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 屏幕坐标 转换为 笛卡尔空间直角坐标</span></span><br><span class="line"><span class="keyword">var</span> cartesian3 = mars3d.<span class="property">PointUtil</span>.<span class="title function_">getCurrentMousePosition</span>(map.<span class="property">scene</span>, windowPosition);</span><br><span class="line"></span><br><span class="line"><span class="comment">//笛卡尔空间直角坐标 转换为 屏幕坐标</span></span><br><span class="line"><span class="keyword">var</span> windowPosition = <span class="title class_">Cesium</span>.<span class="property">SceneTransforms</span>.<span class="title function_">wgs84ToWindowCoordinates</span>(map.<span class="property">scene</span>, cartesian3);</span><br><span class="line"></span><br><span class="line"><span class="comment">//笛卡尔空间直角坐标   转换为   地理坐标(弧度制)</span></span><br><span class="line"><span class="keyword">var</span> cartographic = <span class="title class_">Cesium</span>.<span class="property">Cartographic</span>.<span class="title function_">fromCartesian</span>(cartesian3);</span><br><span class="line"></span><br><span class="line"><span class="comment">//笛卡尔空间直角坐标   转换为   地理坐标(经纬度)</span></span><br><span class="line"><span class="keyword">var</span> point = mars3d.<span class="property">LatLngPoint</span>.<span class="title function_">fromCartesian</span>(cartesian3);</span><br><span class="line"></span><br><span class="line"><span class="comment">//地理坐标(弧度制)   转换为   笛卡尔空间直角坐标</span></span><br><span class="line"><span class="keyword">var</span> cartesian3 = <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromRadians</span>(lng, lat, height); <span class="comment">//lng\lat为弧度制</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//地理坐标(经纬度)  转换为  笛卡尔空间直角坐标</span></span><br><span class="line"><span class="keyword">var</span> cartesian3 = <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromDegrees</span>(longitude, latitude, height); </span><br></pre></td></tr></tbody></table></figure>

<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/450822964">Mars3D中坐标系及坐标变换</a> 这里的各种坐标转换的API说明，可以用的到。平台为我们提供了如下几种很有用的 计算机图形学中的变换工具类（如平移旋转缩放）Cesium.Cartesian3 ：相当于Point3D。Cesium.Matrix3 ：3x3矩阵，用于描述旋转变换。Cesium.Matrix4 ：4x4矩阵，用于描述旋转加平移变换。Cesium.Quaternion ：四元数，用于描述围绕某个向量旋转一定角度的变换。Cesium.Transforms ：包含将位置转换为各种参考系的功能。<br>2.<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/608523299">cesium实现矩形、多边形的手动绘制、拉伸和移动效果</a> 这个稍微有些复杂，还是需要仔细的去研读这个里面的代码。<br>3.<a target="_blank" rel="noopener" href="https://juejin.cn/post/7271658672370335779">Cesium 中如何垂直抬升、水平移动、旋转模型 </a> 这里用了一个矩阵变换进行了处理，其实就是静态的。<br>4.<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/475811344">Mars3D之三维空间视角</a><br>5.<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44806249/article/details/122256972">Mars3d开发——坐标系以及事件机制</a> 这里也有各种坐标的转换方法，还有些事件的方法。</div>
<h2 id="15-放大缩小"><a href="#15-放大缩小" class="headerlink" title="15.放大缩小"></a>15.放大缩小</h2><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> mars3d <span class="keyword">from</span> <span class="string">'mars3d'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 地图放大 */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">zoomOutHandler</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">  <span class="keyword">let</span> map = <span class="variable language_">window</span>.<span class="property">mainmap</span>;</span><br><span class="line">  <span class="keyword">let</span> lngLat = map.<span class="title function_">getCenter</span>();</span><br><span class="line">  <span class="comment">// 镜头拉进</span></span><br><span class="line">  map.<span class="title function_">flyToPoint</span>(<span class="keyword">new</span> mars3d.<span class="title class_">LngLatPoint</span>(lngLat.<span class="property">lng</span>, lngLat.<span class="property">lat</span>, -<span class="number">10000</span>));</span><br><span class="line">};</span><br><span class="line"><span class="comment">/* 地图缩小 */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">zoomInHandler</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">  <span class="keyword">let</span> map = <span class="variable language_">window</span>.<span class="property">mainmap</span>;</span><br><span class="line">  <span class="keyword">let</span> lngLat = map.<span class="title function_">getCenter</span>();</span><br><span class="line">  <span class="comment">// 镜头拉进</span></span><br><span class="line">  map.<span class="title function_">flyToPoint</span>(<span class="keyword">new</span> mars3d.<span class="title class_">LngLatPoint</span>(lngLat.<span class="property">lng</span>, lngLat.<span class="property">lat</span>, <span class="number">10000</span>));</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<div class="reference">参考文章:<br>1.<a target="_blank" rel="noopener" href="https://blog.aayu.today/gis/cesium/learning-notes/20200925-1/">自定义镜头缩放</a> 原理很简单，通过 Cesium 提供的 viewer.camera.zoomIn() 和 viewer.camera.zoomOut API 即可。<br>2.<a target="_blank" rel="noopener" href="https://juejin.cn/post/7023271145944121352">cesium地图放大缩小</a> 这是cesium的代码。<br>3.<a target="_blank" rel="noopener" href="http://mars3d.cn/api/Map.html?classFilter=map">flyToPoint</a></div>
<h1 id="16-ERR-REQUIRE-ESM-require-of-ES-Module-not-supported"><a href="#16-ERR-REQUIRE-ESM-require-of-ES-Module-not-supported" class="headerlink" title="16. ERR_REQUIRE_ESM require() of ES Module not supported"></a>16. ERR_REQUIRE_ESM require() of ES Module not supported</h1><p>我在 jeecgboot3.6.3 中使用 vite-plugin-mars3d 插件，结果就报了这个错误，启动不了程序。不知道问题出在了哪里，但是根据模版中的版本，其实 vite:5.1.3 和 vite-plugin-mars3d 是可以共存的。</p>
<p>出现此错误的原因是模块已外部化。对于支持CJS的模块，我们最好将其外部化。对于只支持 ESM 的模块（例如 lowdb、execa、node-fetch 等），我们不应该将其外部化。</p>
<p>【尝试方案】<br>（1）我尝试去升级 vite 版本到最新版，还是不行。<br>（2）尝试修改 package.json,增加 “type”: “module”, 结果出现了其他的错误：”convertLegacyToken” is not a function，解决了这个问题，之后又出现了新的错误：vueSetupExtend is not a function，而这个问题的解决就是将 “type”:”module” 去掉。<br>（3）我尝试重新修改 vite-plugin-mars3d.umd.cjs 中的 require 引入方式,将require改为import引入，结果出现了：d.viteExternalsPlugin is not a function<br>（4）尝试修改引入 mars3d 插件，结果还是出错，解决方法就是增加 “type”: “module”</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { mars3dPlugin } <span class="keyword">from</span> <span class="string">'vite-plugin-mars3d/dist/index'</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>（5）我查看了 vite-plugin-mars3d 的 3.0.0 版本和 4.0.0 版本的 index.d.ts 的不同<br>（6）安装了 ts-node，然后修改了 ts.config.js，”module”: “CommonJS”,后来我还增加了     “ts-node”: { “esm”: true }<br>（7）安装了 vite-plugin-require-transform 插件，然后引入了这个插件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { defineConfig } <span class="keyword">from</span> <span class="string">'vite'</span></span><br><span class="line"><span class="keyword">import</span> requireTransform <span class="keyword">from</span> <span class="string">'vite-plugin-require-transform'</span> <span class="comment">// 1. 引入插件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>({</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// 2. 添加以下代码</span></span><br><span class="line">        <span class="title function_">requireTransform</span>({</span><br><span class="line">            <span class="attr">fileRegex</span>: <span class="regexp">/.js$|.vue$/</span>,</span><br><span class="line">        }),</span><br><span class="line">    ],</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>（8）adding “type”: “module” to the nearest package.json;    renaming vite.config.js/vite.config.ts to vite.config.mjs/vite.config.mts<br>（9）尝试加载 import { mars3dPlugin } from ‘../../../node_modules/vite-plugin-mars3d/dist/vite-plugin-mars3d.umd.mjs’;</p>
<p>【解决方案】<br>（1）有一个小伙子的解决方案就是将 vite-plugin-mars3d 版本降到 3.0.0，这个可以解决问题。<br>（2）第二个解决方法就是使用 cdn 的方式引入 mars3d，也是可以的。</p>
<div class="reference">参考文章:<br>【1】.<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/69081410/error-err-require-esm-require-of-es-module-not-supported">Error [ERR_REQUIRE_ESM]: require() of ES Module not supported [duplicate]</a> I figured it out. I just had to downgrade node-fetch to 2.6.6, as the higher versions only use ESM, which caused a lot of errors.<br>【2】.<a target="_blank" rel="noopener" href="https://gitee.com/marsgis/mars3d-vue-template/blob/master/mars3d-vue3-vite/package.json">火星科技 / mars3d-vue-template </a> “vite”: “^5.1.3”,”vite-plugin-mars3d”: “^4.0.0”<br>【3】.<a target="_blank" rel="noopener" href="https://github.com/vueComponent/ant-design-vue/issues/6775">TypeError: “convertLegacyToken” is not a function</a><br>【4】.<a target="_blank" rel="noopener" href="https://github.com/ant-design/ant-design/discussions/39110">How to use convertLegacyToken with less-loader in vite</a><br>【5】.<a target="_blank" rel="noopener" href="https://blog.csdn.net/liushuiwuqing91/article/details/134058791">jeecg-vue3 UI框架升级到antd4.x</a> 因antd4.x放弃了less，但是jeecg-vue3中还要大量less变量，所以要兼容两者。<br>【6】.<a target="_blank" rel="noopener" href="https://github.com/vitejs/vite/issues/9414">vite V3.0.0 vite.config.ts 引入插件报错(***** is not a function)</a> 这里就是删除 type:module。<br>【7】.<a target="_blank" rel="noopener" href="https://github.com/vitejs/vite/discussions/15775">vite5使用vite-plugin-vue-setup-extend-plus报错TypeError: vueSetupExtend is not a function</a><br>【8】.<a target="_blank" rel="noopener" href="https://www.cnblogs.com/LuoCore/p/17251402.html">vite V3.0.0 vite.config.ts 引入插件vite-plugin-vue-setup-extend-plus报错（vueSetupExtend不是一个函数）</a><br>【9】.<a target="_blank" rel="noopener" href="https://electron-vite.org/guide/troubleshooting">Error [ERR_REQUIRE_ESM]: require() of ES Module</a> Electron doesn’t support ESM, so the build standard for the main process and preload scripts is still CJS. This error occurs because the module is externalized. For modules that support CJS, we’d better externalize it. For modules that only support ESM (e.g. lowdb, execa, node-fetch, etc.), we should not externalize it. We should let electron-vite bundle it into a CJS standard module to support Electron.<br>【10】.[plugin externalize-deps] Failed to resolve entry for package “@crxjs/vite-plugin”](<a target="_blank" rel="noopener" href="https://github.com/crxjs/chrome-extension-tools/issues/660">https://github.com/crxjs/chrome-extension-tools/issues/660</a>)<br>【11】.<a target="_blank" rel="noopener" href="https://carljin.com/posts/umd-package-in-vite/">如何在 Vite 中使用 UMD 的包</a><br>【12】.<a target="_blank" rel="noopener" href="https://juejin.cn/post/7255943107152625722"> 解决Vite中不能使用require的问题 </a><br>【13】.<a target="_blank" rel="noopener" href="https://github.com/SBoudrias/Inquirer.js/issues/1199">Error [ERR_REQUIRE_ESM]: require() of ES Module </a><br>【14】.<a target="_blank" rel="noopener" href="https://github.com/crcong/vite-plugin-externals/blob/main/README.zh-CN.md">vite-plugin-externals</a><br>【15】.<a target="_blank" rel="noopener" href="https://vitejs.dev/guide/troubleshooting.html#this-package-is-esm-only">This package is ESM only </a> adding “type”: “module” to the nearest package.json;    renaming vite.config.js/vite.config.ts to vite.config.mjs/vite.config.mts</div></body></html>
              </div>
            </div>
          </div>
          <div class='post-footer'>
            <div>**本文已结束，感谢您的观看**</div>
            <div class="btn btn-pay">鼓励一下</div>
          </div>
          
            <div class="page">
              
              <section class="past-wrap">
                <section class="past">
                <p>往期推荐</p>
                </section>
              </section>
              <div class="post-nav">
                <div class="post-nav-next post-nav-item">
                  
                    <a href="/posts/5bc07177.html" rel="next" title="软件研究之NFS系统">
                      <i class="iconfont icon-prev"></i> 软件研究之NFS系统
                    </a>
                  
                </div>

                <span class="post-nav-divider"></span>

                <div class="post-nav-prev post-nav-item">
                  
                    <a href="/posts/ded1db79.html" rel="prev" title="软件研究之MapServer">
                      软件研究之MapServer <i class="iconfont icon-next"></i>
                    </a>
                  
                </div>
              </div>
            </div>
          
          
 <div class="comments" id="comments">
    <div id="disqus_thread">
        <noscript>
            不支持Javascript,那你还上啥网啊。
            <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript"></a>
        </noscript>
    </div>
</div>

      </div>
    </div>


    <div class="layui-col-md2 layui-col-lg2 layui-col-sm10 layui-col-xs12 catalogue-wrap">
        

<div class="catalogue-content">
    <div class="title">文章目录</div>
    <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">1.前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9D%90%E6%A0%87%E7%B3%BB"><span class="toc-number">3.</span> <span class="toc-text">2.坐标系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%B8%8D%E5%90%8C%E7%BA%A7%E5%88%AB%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%90%8C%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">3.不同级别显示不同的样式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-GeoJsonLayer%E5%9B%BE%E7%89%87%E7%B1%BB%E5%9E%8B%E7%89%B9%E5%88%AB%E7%9A%84%E5%8D%A1"><span class="toc-number">5.</span> <span class="toc-text">4.GeoJsonLayer图片类型特别的卡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-GeoJsonLayer%E6%B2%A1%E6%9C%89image%E5%B1%9E%E6%80%A7"><span class="toc-number">6.</span> <span class="toc-text">5.GeoJsonLayer没有image属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Cesium-is-not-defined"><span class="toc-number">7.</span> <span class="toc-text">6.Cesium is not defined</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%8E%9F%E7%94%9FCesium%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.</span> <span class="toc-text">7.原生Cesium无法加载模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-mars3d%E5%92%8Cmars3d-cesium%E7%8B%AC%E7%AB%8B%E6%89%93%E5%8C%85"><span class="toc-number">9.</span> <span class="toc-text">8.mars3d和mars3d-cesium独立打包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E9%BC%A0%E6%A0%87%E7%82%B9%E5%87%BB%E9%AB%98%E4%BA%AE"><span class="toc-number">10.</span> <span class="toc-text">9.鼠标点击高亮</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-vitePluginMars3d-is-not-a-function"><span class="toc-number">11.</span> <span class="toc-text">10.vitePluginMars3d is not a function</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%8A%A0%E8%BD%BD%E7%9A%84Geojson%E6%80%BB%E6%98%AF%E5%85%88%E6%98%BE%E7%A4%BA%E7%84%B6%E5%90%8E%E6%B6%88%E5%A4%B1"><span class="toc-number">12.</span> <span class="toc-text">11.加载的Geojson总是先显示然后消失</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-mars3d-heatmap%E6%8F%92%E4%BB%B6"><span class="toc-number">13.</span> <span class="toc-text">12.mars3d-heatmap插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-mars3d-echarts%E6%8F%92%E4%BB%B6"><span class="toc-number">14.</span> <span class="toc-text">13.mars3d-echarts插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E7%A7%BB%E5%8A%A8popup"><span class="toc-number">15.</span> <span class="toc-text">14.移动popup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E6%94%BE%E5%A4%A7%E7%BC%A9%E5%B0%8F"><span class="toc-number">16.</span> <span class="toc-text">15.放大缩小</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-ERR-REQUIRE-ESM-require-of-ES-Module-not-supported"><span class="toc-number"></span> <span class="toc-text">16. ERR_REQUIRE_ESM require() of ES Module not supported</span></a>
    </div>
</div>


        <div class="sidecontent">

    

    <div class="side-panel side-sponsor">
        <div class="side-title one">小额赞助</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">本人提供免费与付费咨询服务，感谢您的支持！赞助请发邮件通知，方便公布您的善意！</div>
                <div class="content">
                    <img src="/images/pay.png" title="小额赞助"/>
                </div>
                
                
                <div class="donor_content">
                    
                        
                        <div class="donor-item">
                            <span class="name">**光</span>
                            <span class="money">3.01 元</span>
                        </div>
                    
                        
                        <div class="donor-item">
                            <span class="name">Sun</span>
                            <span class="money">3.00 元</span>
                        </div>
                    
                        
                        <div class="donor-item">
                            <span class="name">bibichuan</span>
                            <span class="money">3.00 元</span>
                        </div>
                    
                    <div class="donor_footer">
                        <span>捐赠者名单</span>
                        <span class="total">合计：9.01 元</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="side-ad side-panel">
        <div class="side-title two">微信公众号</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <img src="/images/wechat.png" title="公众号"/>
            </div>
        </div>
    </div>

    <div class="side-ad side-panel">
        <div class="side-title one">广告位</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">诚心邀请广大金主爸爸洽谈合作</div>
                <div class="detail">
                </div>
            </div>
        </div>
    </div>

    <div class="side-ask side-panel">
        
        <div class="side-title two">每日一省</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">isNaN 和 Number.isNaN 函数的区别？</div>
                <div class="detail">
                    
                        <p>1.函数 isNaN 接收参数后，会尝试将这个参数转换为数值，任何不能被转换为数值的的值都会返回 true，因此非数字值传入也会返回 true ，会影响 NaN 的判断。</p>
                    
                        <p>2.函数 Number.isNaN 会首先判断传入参数是否为数字，如果是数字再继续判断是否为 NaN ，不会进行数据类型的转换，这种方法对于 NaN 的判断更为准确。</p>
                    
                </div>
            </div>
            <div class="side-footer">
                <span class="side-footer-item time">2021-04-07</span>
                
                    <span class="side-footer-item side-button down" title="查看答案">
                        <i class="iconfont icon-expansion"></i>
                    </span>
                
                
                    <a class="side-footer-item side-button answer-url" href="https://juejin.cn/post/6940945178899251230"
                    target="_blank">链接地址</a>
                
            </div>
        </div>
    </div>
    <div class="side-ask side-panel">
        
        <div class="side-title three">每日二省</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">为什么0.1+0.2 ! == 0.3，如何让其相等?</div>
                <div class="detail">
                     
                        <p>一个直接的解决方法就是设置一个误差范围，通常称为“机器精度”。对JavaScript来说，这个值通常为2-52，在ES6中，提供了Number.EPSILON属性，而它的值就是2-52，只要判断0.1+0.2-0.3是否小于Number.EPSILON，如果小于，就可以判断为0.1+0.2 ===0.3。</p>
                    
                </div>
            </div>
            <div class="side-footer">
                <span class="side-footer-item time">2021-04-07</span>
                
                    <span class="side-footer-item side-button down" title="查看答案">
                        <i class="iconfont icon-expansion"></i>
                    </span>
                
                
                    <a class="side-footer-item side-button answer-url" href="https://juejin.cn/post/6940945178899251230#heading-8"
                    target="_blank">链接地址</a>
                
            </div>
        </div>
    </div>
    <div class="side-ask side-panel">
        
        <div class="side-title three">每日三省</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">== 操作符的强制类型转换规则？</div>
                <div class="detail">
                     
                        <p>1.首先会判断两者类型是否**相同，**相同的话就比较两者的大小。</p>
                    
                        <p>2.类型不相同的话，就会进行类型转换。</p>
                    
                        <p>3.会先判断是否在对比 null 和 undefined，是的话就会返回 true。</p>
                    
                        <p>4.判断两者类型是否为 string 和 number，是的话就会将字符串转换为 number。</p>
                    
                        <p>5.判断其中一方是否为 boolean，是的话就会把 boolean 转为 number 再进行判断。</p>
                    
                        <p>6.判断其中一方是否为 object 且另一方为 string、number 或者 symbol，是的话就会把 object 转为原始类型再进行判断。</p>
                    
                </div>
            </div>
            <div class="side-footer">
                <span class="side-footer-item time">2021-04-07</span>
                
                    <span class="side-footer-item side-button down" title="查看答案">
                        <i class="iconfont icon-expansion"></i>
                    </span>
                
                
                    <a class="side-footer-item side-button answer-url" href="https://juejin.cn/post/6940945178899251230#heading-12"
                    target="_blank">链接地址</a>
                
            </div>
        </div>
    </div>
    <div class="side-ask side-panel">
        
        <div class="side-title two">每日英语</div>
        <div class="side-content-wrap">
            <div class="side-content">
                <div class="heading">Happiness is time precipitation, smile is the lonely sad.</div>
                <div class="detail">幸福是年华的沉淀，微笑是寂寞的悲伤。</div>
            </div>
            <div class="side-footer">
                <span class="side-footer-item time">2016</span>
                
                    <span class="side-footer-item side-button down" title="查看翻译">
                        <i class="iconfont icon-expansion"></i>
                    </span>
                
                <span class="side-footer-item author">——— 美文</span>
            </div>
        </div>
    </div>

</div>
    </div>

  </div>
  <div class="side-tool">
    <div class="side-icon-wrap">
        <i class="iconfont icon-sidemenu"></i>
    </div>
    <ul class="side-tool-content">
        <li title="回到顶部" class="back-to-top side-tool-item">
            <a class="function-button"><i class="iconfont icon-backtop"></i></a>
        </li> 
        <li title="分享文章" class="side-share side-tool-item">
            <a class="function-button"><i class="iconfont icon-share"></i></a>
            <div class="iShare iShare-content"></div>
        </li>
        <li title="喜欢文章" class="side-like side-tool-item">
            <a class="function-button"><i class="iconfont icon-like"></i></a>
        </li>
         <li class="side-close" title="关闭侧边栏">
            <a class="function-button"><i class="iconfont icon-close"></i></a>
        </li>
    </ul>
</div>

      </div>
    </main>   
    
    <footer id="footer" class="footer layui-fluid">
      <div class="layui-row">
        <div class="container footer-inner">
          <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="footer-col">
  <div>温馨提示</div>
  <div><a href="/about" target="_self">关于作者</a></div>
  <div><a href="/archives">博客归档</a></div>
  <div>
    <span id="busuanzi_container_site_uv">
      访客数<span id="busuanzi_value_site_uv"></span>人次
    </span>
  </div>
</div>
<div class="footer-col">
  <div>友情链接</div>
  
  
  
  
    
        <div><a href="https://malagis.com" target="_blank">麻辣GIS</a></div>
    
  
    
        <div><a href="https://www.giserdqy.com" target="_blank">GIS开发者</a></div>
    
  
    
        <div><a href="https://earth.nullschool.net/zh-cn/" target="_blank">earth.nullschool</a></div>
    
  
    
        <div><a href="https://www.gisclouder.com/" target="_blank">码上GIS实现的热力图</a></div>
    
  
    
        <div><a href="http://www.cnblogs.com/naaoveGIS/" target="_blank">李晓辉的博客园</a></div>
    
  
    
        
          <div><a href="/links">更多</a></div>
          
        
    
  
    
        
    
  
    
        
    
  
    
        
    
  
  <div class="chain-msg">**注意：以上网站都没给钱**</div>
</div>
<div class="footer-col">
  <div>精彩推荐</div>
  
    <div><a href="/study">励志</a></div>
  
    <div><a href="/anime">动漫</a></div>
  
    <div><a href="/movie">电影</a></div>
  
    <div><a href="/tv">电视</a></div>
  
    <div><a href="/book">书籍</a></div>
  
</div>
<div class="footer-col">
  <div>开源项目</div>
  
    <div><a href="/"></a></div>
  
</div>
          
        </div>
      </div>
    </footer>

    


<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>

    
        
            
            
            <script type="text/javascript" src="/lib/layui/layui.js"></script>
        
    
        
    

    
        
            
            
                
            
            <script type="text/javascript" src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
        
    

    
        
            
            
            <script type="text/javascript" src="/lib/jquery.actual.min.js"></script>
        
    


    


  <script type="text/javascript" src="/js/src/utils.js?v="></script>



    
      <script type="text/javascript" src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
<script type="text/javascript">
  var client = algoliasearch('DM9LMZOGZE', '1c2739694b8acb4c4edab8ccb098d166');
  var index = client.initIndex('bibichuan');
  $(document).ready(function(){
    var $search=$(".header-wrap");
    var $searchbtn= $search.find(".find");
    var $ipt=$search.find(".search-ipt");
    var $resultClear=$search.find(".clear");
    var $result=$search.find(".result");
    // 加入layui
    layui.use('layer', function(){
      var layer = layui.layer;
      // 搜索按钮点击
      $searchbtn.on("click",function(){
        var text=$ipt.val();
        var $this=$(this);
        var $resultContent=$result.find(".result-content");
        if(text){
          var loadDialog=layer.load();
          if(!$this.hasClass("disabled")){
            $this.addClass("disabled");
            index.search(text, (err, { hits } = {}) => {
              layer.close(loadDialog); 

              $this.removeClass("disabled");
              var resultHtml="";
              // 命中
              if(hits.length>0){
                var count=hits.length;
                for(var i=0;i<count;i++){
                  var h=hits[i];
                  //根据返回值中_highlightResult来判断显示的内容。
                  var content=h.contentStripTruncate;
                  var _highlight=h._highlightResult;

                  var resultC="";
                  var hitType=""; // 命中的类型
                  //标题命中
                  if(_highlight.title&&!resultC){  
                    if(_highlight.title.matchLevel&&_highlight.title.matchLevel!='none'){
                      resultC=_highlight.title.value;
                      hitType="title";
                    }
                  }
                  //分类命中
                  if(_highlight.categories&&!resultC){ 
                    var arr=_highlight.categories;
                    if(arr instanceof Array){
                      var countTemp=arr.length;
                      for(var j=0;j<countTemp;j++){
                        var temp=arr[j];
                        if(temp.matchLevel&&temp.matchLevel!='none'){
                          resultC=temp.value;
                          hitType="categories";
                        }
                      }
                    }else{
                      if(arr.matchLevel&&arr.matchLevel!='none'){
                        resultC=arr.value;
                        hitType="categories";
                      }
                    }
                  }

                  //标签命中
                  if(_highlight.tags&&!resultC){ 
                    var arr=_highlight.tags;
                    if(arr instanceof Array){
                      var countTemp=arr.length;
                      for(var j=0;j<countTemp;j++){
                        var temp=arr[j];
                        if(temp.matchLevel&&temp.matchLevel!='none'){
                          resultC=temp.value;
                          hitType="tags";
                        }
                      }
                    }else{
                      if(arr.matchLevel&&arr.matchLevel!='none'){
                        resultC=arr.value;
                        hitType="tags";
                      }
                    }
                  }

                  // 内容命中
                  if(!resultC){ 
                    resultC=_highlight.contentStripTruncate.value;
                    hitType="contentStripTruncate";
                  }

                  //如果内容过长，则截断
                  if(resultC.length>50){
                    var index=resultC.indexOf('<em>');
                    var blockIndex=10;
                    if(index>=blockIndex){
                      index=index-blockIndex;
                    }else{
                      index=0;
                    }
                    resultC="..."+resultC.substring(index,index+20+blockIndex)+"...";
                  }
                  switch(hitType){
                    case "title":
                      resultC="标题："+resultC;
                      break;
                    case "categories":
                      resultC="分类："+resultC;
                      resultC+=" ("+h.contentStripTruncate.substring(0,40)+"...)";
                      break;
                    case "tags":
                      resultC="标签："+resultC;
                      resultC+=" ("+h.contentStripTruncate.substring(0,40)+"...)";
                      break;
                    case "contentStripTruncate":
                      resultC="内容："+resultC;
                      break;
                  }

                  resultHtml+='<li class="result-item" title="'+content+'"><a href="'+h.permalink+'">'+resultC+'</a></li>';
                }
                $(resultHtml).appendTo($resultContent.empty());
                $result.show();
                $resultClear.show();
              }else{
                var resultHtml='<li class="result-item" title="未找到相关内容"><a>未找到相关内容</a></li>';
                $(resultHtml).appendTo($resultContent.empty());
                $result.show();
                $resultClear.show();
              }
            });
          }
        }else{
          layer.msg("请输入搜索内容");
        }
      });
      // 删除输入内容
      $resultClear.on("click",function(){
        $result.hide();
        $resultClear.hide();
        //清空输入内容
        $ipt.val("");
      });
      // 监听确定事件
      $ipt.keydown(function(e){
        if(e.keyCode==13){
          $searchbtn.click();
        }
      });
    });              
  
  });
</script>
    

    
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.js"></script>
<script src="/js/src/post/post.js">></script>

  

  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = 'https://bibichuan.github.io/posts/45093bb7.html';
      this.page.identifier = 'posts/45093bb7.html';
      this.page.title = '软件研究之Mars3d';
      };
    // 加载评论内容
    function loadComments () {
      var d = document, s = d.createElement('script');
      s.src = 'https://https-bibichuan-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);

      // 隐藏相关文章
      s.onload = function () {
        var relatedCommon=$('#comments #disqus_recommendations');
        if(relatedCommon){
          relatedCommon.hide();
        }

      }
    }
    function scrollFunction(){
      // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = $('#comments').offset().top - $(window).height();
          var scrollTop = $(window).scrollTop();

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            $(window).off('scroll',scrollFunction);
            loadComments();
          }
    }
    $(function () {
      if($("#comments").length<=0){
        return;
      }
      var offsetTop = $('#comments').offset().top - $(window).height();
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        loadComments();
      } else {
        $(window).on('scroll', scrollFunction);
      }
    });
  </script>



<script src="/lib/share/iShare.js"></script>
<script type="text/javascript">
var iSharel=(new iShare({container:'.iShare-content',config:{
		title: '这里有精彩的内容，你确定不过来看看吗？链接标题：软件研究之Mars3d 链接地址:https://bibichuan.github.io/posts/45093bb7.html  |(复制此地址在浏览器中打开)——bibichaun出品。',
		description: '软件研究之Mars3d',
		url: 'https://bibichuan.github.io/posts/45093bb7.html',
		isAbroad: false,
		isTitle: true,
		initialized: true,
		WXoptions:{
			evenType: 'click',
			isTitleVisibility: true,
			title: '软件研究之Mars3d',
			isTipVisibility: true,
			tip: '软件研究之Mars3d',
			qrcodeW: '120',
			qrcodeH: '120',
			qrcodeFgc: '#4a148c',
      bgcolor: '#2BAD13'
		}
	}}));
</script>


</body>
</html>